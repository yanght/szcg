/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define("esri/renderer",["dijit","dojo","dojox","dojo/require!esri/graphic,dojo/date"],function(_1,_2,_3){_2.provide("esri.renderer");_2.require("esri.graphic");_2.require("dojo.date");esri.renderer.fromJson=function(_4){var _5=_4.type||"",_6;switch(_5){case "simple":_6=new esri.renderer.SimpleRenderer(_4);break;case "uniqueValue":_6=new esri.renderer.UniqueValueRenderer(_4);break;case "classBreaks":_6=new esri.renderer.ClassBreaksRenderer(_4);break;}return _6;};_2.declare("esri.renderer.Renderer",null,{constructor:function(){this.getSymbol=_2.hitch(this,this.getSymbol);},getSymbol:function(_7){},toJson:function(){}});_2.declare("esri.renderer.SimpleRenderer",esri.renderer.Renderer,{constructor:function(_8){if(_8&&!_8.declaredClass){var _9=_8;_8=_9.symbol;if(_8){this.symbol=esri.symbol.fromJson(_8);}this.label=_9.label;this.description=_9.description;}else{this.symbol=_8;}},getSymbol:function(_a){return this.symbol;},toJson:function(){return esri._sanitize({type:"simple",label:this.label,description:this.description,symbol:this.symbol&&this.symbol.toJson()});}});_2.declare("esri.renderer.UniqueValueRenderer",esri.renderer.Renderer,{constructor:function(_b,_c,_d,_e,_f){this.values=[];this._symbols={};this.infos=[];if(_b&&!_b.declaredClass){var _10=_b;_b=_10.defaultSymbol;if(_b){this.defaultSymbol=esri.symbol.fromJson(_b);}this.attributeField=_10.field1;this.attributeField2=_10.field2;this.attributeField3=_10.field3;this.fieldDelimiter=_10.fieldDelimiter;this.defaultLabel=_10.defaultLabel;_2.forEach(_10.uniqueValueInfos,this._addValueInfo,this);}else{this.defaultSymbol=_b;this.attributeField=_c;this.attributeField2=_d;this.attributeField3=_e;this.fieldDelimiter=_f;}this._multiple=!!this.attributeField2;},addValue:function(_11,_12){var _13=_2.isObject(_11)?_11:{value:_11,symbol:_12};this._addValueInfo(_13);},removeValue:function(_14){var i=_2.indexOf(this.values,_14);if(i===-1){return;}this.values.splice(i,1);delete this._symbols[_14];this.infos.splice(i,1);},getSymbol:function(_15){var _16=this.attributeField,_17=_15.attributes,_18,_19,_1a;if(this._multiple){_18=this.attributeField2;_19=this.attributeField3;_1a=[];if(_16){_1a.push(_17[_16]);}if(_18){_1a.push(_17[_18]);}if(_19){_1a.push(_17[_19]);}return this._symbols[_1a.join(this.fieldDelimiter||"")]||this.defaultSymbol;}else{_16=_2.isFunction(_16)?_16(_15):_17[_16];return this._symbols[_16]||this.defaultSymbol;}},_addValueInfo:function(_1b){var _1c=_1b.value;this.values.push(_1c);this.infos.push(_1b);var _1d=_1b.symbol;if(_1d){if(!_1d.declaredClass){_1b.symbol=esri.symbol.fromJson(_1d);}}this._symbols[_1c]=_1b.symbol;},toJson:function(){var _1e=esri._sanitize;return _1e({type:"uniqueValue",field1:this.attributeField,field2:this.attributeField2,field3:this.attributeField3,fieldDelimiter:this.fieldDelimiter,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.toJson(),defaultLabel:this.defaultLabel,uniqueValueInfos:_2.map(this.infos||[],function(_1f){_1f=_2.mixin({},_1f);_1f.symbol=_1f.symbol&&_1f.symbol.toJson();_1f.value=_1f.value+"";return _1e(_1f);})});}});_2.declare("esri.renderer.ClassBreaksRenderer",esri.renderer.Renderer,{constructor:function(sym,_20){this.breaks=[];this._symbols={};this.infos=[];if(sym&&!sym.declaredClass){var _21=sym;this.attributeField=_21.field;sym=_21.defaultSymbol;if(sym){this.defaultSymbol=esri.symbol.fromJson(sym);}this.defaultLabel=_21.defaultLabel;var min=_21.minValue,_22=_21.classBreakInfos;if(_22&&_22[0]&&esri._isDefined(_22[0].classMaxValue)){_2.forEach(_22,function(_23){var _24=_23.classMaxValue;_23.minValue=min;_23.maxValue=_24;min=_24;},this);}_2.forEach(_22,this._addBreakInfo,this);}else{this.defaultSymbol=sym;this.attributeField=_20;}},addBreak:function(min,max,_25){var _26=_2.isObject(min)?min:{minValue:min,maxValue:max,symbol:_25};this._addBreakInfo(_26);},removeBreak:function(min,max){var _27,_28=this.breaks,i,il=_28.length,_29=this._symbols;for(i=0;i<il;i++){_27=_28[i];if(_27[0]==min&&_27[1]==max){_28.splice(i,1);delete _29[min+"-"+max];this.infos.splice(i,1);break;}}},clearBreaks:function(){this.breaks=[];this._symbols={};this.infos=[];},getSymbol:function(_2a){var _2b=this.attributeField,val=_2.isFunction(_2b)?_2b(_2a):parseFloat(_2a.attributes[_2b]),rs=this.breaks,i,il=rs.length,_2c=this._symbols,_2d,_2e=this.isMaxInclusive;for(i=0;i<il;i++){_2d=rs[i];if(_2d[0]<=val&&(_2e?(val<=_2d[1]):(val<_2d[1]))){return _2c[_2d[0]+"-"+_2d[1]];}}return this.defaultSymbol;},setMaxInclusive:function(_2f){this.isMaxInclusive=_2f;},_addBreakInfo:function(_30){var min=_30.minValue,max=_30.maxValue;this.breaks.push([min,max]);this.infos.push(_30);var _31=_30.symbol;if(_31){if(!_31.declaredClass){_30.symbol=esri.symbol.fromJson(_31);}}this._symbols[min+"-"+max]=_30.symbol;},toJson:function(){var _32=this.infos||[],_33=esri._sanitize;var _34=_32[0]&&_32[0].minValue;return _33({type:"classBreaks",field:this.attributeField,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.toJson(),defaultLabel:this.defaultLabel,minValue:(_34===-Infinity)?-Number.MAX_VALUE:_34,classBreakInfos:_2.map(_32,function(_35){_35=_2.mixin({},_35);_35.symbol=_35.symbol&&_35.symbol.toJson();_35.classMaxValue=(_35.maxValue===Infinity)?Number.MAX_VALUE:_35.maxValue;delete _35.minValue;delete _35.maxValue;return _33(_35);})});}});_2.declare("esri.renderer.TemporalRenderer",esri.renderer.Renderer,{constructor:function(_36,_37,_38,_39){this.observationRenderer=_36;this.latestObservationRenderer=_37;this.trackRenderer=_38;this.observationAger=_39;},getSymbol:function(_3a){var _3b=_3a.getLayer();var _3c=_3b._getKind(_3a);var _3d=(_3c===0)?this.observationRenderer:(this.latestObservationRenderer||this.observationRenderer);var _3e=(_3d&&_3d.getSymbol(_3a));var _3f=this.observationAger;if(_3b.timeInfo&&_3b._map.timeExtent&&(_3d===this.observationRenderer)&&_3f&&_3e){_3e=_3f.getAgedSymbol(_3e,_3a);}return _3e;}});_2.declare("esri.renderer.SymbolAger",null,{getAgedSymbol:function(_40,_41){},_setSymbolSize:function(_42,_43){switch(_42.type){case "simplemarkersymbol":_42.setSize(_43);break;case "picturemarkersymbol":_42.setWidth(_43);_42.setHeight(_43);break;case "simplelinesymbol":case "cartographiclinesymbol":_42.setWidth(_43);break;case "simplefillsymbol":case "picturefillsymbol":if(_42.outline){_42.outline.setWidth(_43);}break;}}});_2.declare("esri.renderer.TimeClassBreaksAger",esri.renderer.SymbolAger,{constructor:function(_44,_45){this.infos=_44;this.timeUnits=_45||"day";_44.sort(function(a,b){if(a.minAge<b.minAge){return -1;}if(a.minAge>b.minAge){return 1;}return 0;});},getAgedSymbol:function(_46,_47){var _48=_47.getLayer(),_49=_47.attributes,_4a=esri._isDefined;_46=esri.symbol.fromJson(_46.toJson());var _4b=_48._map.timeExtent;var _4c=_4b.endTime;if(!_4c){return _46;}var _4d=new Date(_49[_48._startTimeField]);var _4e=_2.date.difference(_4d,_4c,this.timeUnits);_2.some(this.infos,function(_4f){if(_4e>=_4f.minAge&&_4e<=_4f.maxAge){var _50=_4f.color,_51=_4f.size,_52=_4f.alpha;if(_50){_46.setColor(_50);}if(_4a(_51)){this._setSymbolSize(_46,_51);}if(_4a(_52)&&_46.color){_46.color.a=_52;}return true;}},this);return _46;}});_2.mixin(esri.renderer.TimeClassBreaksAger,{UNIT_DAYS:"day",UNIT_HOURS:"hour",UNIT_MILLISECONDS:"millisecond",UNIT_MINUTES:"minute",UNIT_MONTHS:"month",UNIT_SECONDS:"second",UNIT_WEEKS:"week",UNIT_YEARS:"year"});_2.declare("esri.renderer.TimeRampAger",esri.renderer.SymbolAger,{constructor:function(_53,_54,_55){this.colorRange=_53;this.sizeRange=_54;this.alphaRange=_55;},getAgedSymbol:function(_56,_57){var _58=_57.getLayer(),_59=_57.attributes;_56=esri.symbol.fromJson(_56.toJson());var _5a=_58._map.timeExtent;var _5b=_5a.startTime,_5c=_5a.endTime;if(!_5b||!_5c){return _56;}_5b=_5b.getTime();_5c=_5c.getTime();var _5d=new Date(_59[_58._startTimeField]);_5d=_5d.getTime();if(_5d<_5b){_5d=_5b;}var _5e=(_5c===_5b)?1:(_5d-_5b)/(_5c-_5b);var _5f=this.sizeRange,_60,_61;if(_5f){var _62=_5f[0],to=_5f[1];_61=Math.abs(to-_62)*_5e;this._setSymbolSize(_56,(_62<to)?(_62+_61):(_62-_61));}_5f=this.colorRange;if(_5f){var _63=_5f[0],_64=_5f[1],_65=Math.round;_60=new _2.Color();var _66=_63.r,toR=_64.r;_61=Math.abs(toR-_66)*_5e;_60.r=_65((_66<toR)?(_66+_61):(_66-_61));var _67=_63.g,toG=_64.g;_61=Math.abs(toG-_67)*_5e;_60.g=_65((_67<toG)?(_67+_61):(_67-_61));var _68=_63.b,toB=_64.b;_61=Math.abs(toB-_68)*_5e;_60.b=_65((_68<toB)?(_68+_61):(_68-_61));var _69=_63.a,toA=_64.a;_61=Math.abs(toA-_69)*_5e;_60.a=(_69<toA)?(_69+_61):(_69-_61);_56.setColor(_60);}_60=_56.color;_5f=this.alphaRange;if(_5f&&_60){var _6a=_5f[0],_6b=_5f[1];_61=Math.abs(_6b-_6a)*_5e;_60.a=(_6a<_6b)?(_6a+_61):(_6a-_61);}return _56;}});});