/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define("esri/geometry/utils",["dijit","dojo","dojox"],function(_1,_2,_3){_2.provide("esri.geometry.utils");(function(){var EG=esri.geometry;EG.normalizeCentralMeridian=function(_4,_5,_6,_7){var _8=new _2.Deferred();_8.addCallbacks(_6,_7);var _9=[],_a=[],_b,_c,_d,_e,_f,_10,_11,_12,_13=0;_2.forEach(_4,function(_14){if(!_14){_9.push(_14);return;}if(!_b){_b=_14.spatialReference;_c=_b._getInfo();_d=_b._isWebMercator();_e=_d?20037508.342788905:180;_f=_d?-20037508.342788905:-180;_10=_d?102100:4326;_11=new esri.geometry.Polyline({"paths":[[[_e,_f],[_e,_e]]],"spatialReference":{"wkid":_10}});_12=new esri.geometry.Polyline({"paths":[[[_f,_f],[_f,_e]]],"spatialReference":{"wkid":_10}});}if(!_c){_9.push(_14);return;}var _15=esri.geometry.fromJson(_2.fromJson(_2.toJson(_14.toJson()))),_16=_14.getExtent();if(_14.type==="point"){_9.push(EG._pointNormalization(_15,_e,_f));}else{if(_14.type==="multipoint"){_15.points=_2.map(_15.points,function(_17){return EG._pointNormalization(_17,_e,_f);});_9.push(_15);}else{if(_14.type==="extent"){_9.push(_16._normalize(null,null,_c));}else{var _18=EG._offsetMagnitude(_16.xmin,_f),_19=_18*(2*_e);_15=(_19===0)?_15:EG._updatePolyGeometry(_15,_19);_16=_16.offset(_19,0);if(_16.intersects(_11)&&(_16.xmax!==_e)){_13=(_16.xmax>_13)?_16.xmax:_13;_15=EG._prepareGeometryForCut(_15,_d);_a.push(_15);_9.push("cut");}else{if(_16.intersects(_12)&&(_16.xmin!==_f)){_13=(_16.xmax*(2*_e)>_13)?_16.xmax*(2*_e):_13;_15=EG._prepareGeometryForCut(_15,_d,360);_a.push(_15);_9.push("cut");}else{_9.push(_15);}}}}}});var _1a=new esri.geometry.Polyline(),_1b=EG._offsetMagnitude(_13,_e),_1c=-90,_1d=_1b;while(_1b>0){var _1e=-180+(360*_1b);_1a.addPath([[_1e,_1c],[_1e,_1c*-1]]);_1c=_1c*-1;_1b--;}if(_a.length>0&&_1d>0){if(_5){_5.cut(_a,_1a,function(_1f){_a=EG._foldCutResults(_a,_1f);var _20=[];_2.forEach(_9,function(_21,i){if(_21==="cut"){var _22=_a.shift();if((_4[i].rings)&&(_4[i].rings.length>1)&&(_22.rings.length>=_4[i].rings.length)){_9[i]="simplify";_20.push(_22);}else{_9[i]=(_d===true)?EG.geographicToWebMercator(_22):_22;}}});if(_20.length>0){_5.simplify(_20,function(_23){_2.forEach(_9,function(_24,i){if(_24==="simplify"){_9[i]=(_d===true)?EG.geographicToWebMercator(_23.shift()):_23.shift();}});_8.callback(_9);},function(_25){_8.errback(_25);});}else{_8.callback(_9);}},function(_26){_8.errback(_26);});}else{_8.errback(new Error("esri.geometry.normalizeCentralMeridian: 'geometryService' argument is missing."));}}else{_2.forEach(_9,function(_27,i){if(_27==="cut"){var _28=_a.shift();_9[i]=(_d===true)?EG.geographicToWebMercator(_28):_28;}});_8.callback(_9);}return _8;};EG.geodesicDensify=function(_29,_2a){var _2b=Math.PI/180;var _2c=6371008.771515059;if(_2a<_2c/10000){_2a=_2c/10000;}if(!(_29 instanceof esri.geometry.Polyline||_29 instanceof esri.geometry.Polygon)){var msg="_geodesicDensify: the input geometry is neither polyline nor polygon";console.error(msg);throw new Error(msg);}var _2d=_29 instanceof esri.geometry.Polyline,_2e=_2d?_29.paths:_29.rings,_2f=[],_30;_2.forEach(_2e,function(_31){_2f.push(_30=[]);_30.push([_31[0][0],_31[0][1]]);var _32,_33,_34,_35,i,j;_32=_31[0][0]*_2b;_33=_31[0][1]*_2b;for(i=0;i<_31.length-1;i++){_34=_31[i+1][0]*_2b;_35=_31[i+1][1]*_2b;var _36=EG._inverseGeodeticSolver(_33,_32,_35,_34);var _37=_36.azimuth;var _38=_36.geodesicDistance;var _39=_38/_2a;if(_39>1){for(j=1;j<=_39-1;j++){var _3a=j*_2a;var pt=EG._directGeodeticSolver(_33,_32,_37,_3a);_30.push([pt.x,pt.y]);}var _3b=(_38+Math.floor(_39-1)*_2a)/2;var _3c=EG._directGeodeticSolver(_33,_32,_37,_3b);_30.push([_3c.x,_3c.y]);}var _3d=EG._directGeodeticSolver(_33,_32,_37,_38);_30.push([_3d.x,_3d.y]);_32=_3d.x*_2b;_33=_3d.y*_2b;}});if(_2d){return new esri.geometry.Polyline({paths:_2f,spatialReference:_29.spatialReference});}else{return new esri.geometry.Polygon({rings:_2f,spatialReference:_29.spatialReference});}};EG.geodesicLengths=function(_3e,_3f){var _40=Math.PI/180;var _41=[];_2.forEach(_3e,function(_42,idx){var _43=0;_2.forEach(_42.paths,function(_44,idx){var _45=0;var i,_46,_47,_48,_49,_4a;for(i=1;i<_44.length;i++){_46=_44[i-1][0]*_40;_47=_44[i][0]*_40;_48=_44[i-1][1]*_40;_49=_44[i][1]*_40;_4a=EG._inverseGeodeticSolver(_48,_46,_49,_47);_45+=_4a.geodesicDistance/1609.344;}_43+=_45;});_43*=EG._unitsDictionary[_3f];_41.push(_43);});return _41;};EG.geodesicAreas=function(_4b,_4c){var _4d=[];_2.forEach(_4b,function(_4e,idx){var _4f=EG.geodesicDensify(_4e,10000);_4d.push(_4f);});var _50=[];var _51,_52;_2.forEach(_4d,function(_53,idx){var _54=0;_2.forEach(_53.rings,function(_55,idx){_51=EG._toEqualAreaPoint(new esri.geometry.Point(_55[0][0],_55[0][1]));_52=EG._toEqualAreaPoint(new esri.geometry.Point(_55[_55.length-1][0],_55[_55.length-1][1]));var _56=_52.x*_51.y-_51.x*_52.y;var i;for(i=0;i<_55.length-1;i++){_51=EG._toEqualAreaPoint(new esri.geometry.Point(_55[i+1][0],_55[i+1][1]));_52=EG._toEqualAreaPoint(new esri.geometry.Point(_55[i][0],_55[i][1]));_56+=_52.x*_51.y-_51.x*_52.y;}_56/=4046.87;_54+=_56;});_54*=EG._unitsDictionary[_4c];_50.push(_54/(-2));});return _50;};EG.polygonSelfIntersecting=function(_57){var i,j,k,m,_58,_59,_5a,_5b=_57.rings.length;for(k=0;k<_5b;k++){for(i=0;i<_57.rings[k].length-1;i++){_58=[[_57.rings[k][i][0],_57.rings[k][i][1]],[_57.rings[k][i+1][0],_57.rings[k][i+1][1]]];for(j=k+1;j<_5b;j++){for(m=0;m<_57.rings[j].length-1;m++){_59=[[_57.rings[j][m][0],_57.rings[j][m][1]],[_57.rings[j][m+1][0],_57.rings[j][m+1][1]]];_5a=esri.geometry._getLineIntersection2(_58,_59);if(_5a){if(!((_5a[0]===_58[0][0]&&_5a[1]===_58[0][1])||(_5a[0]===_59[0][0]&&_5a[1]===_59[0][1])||(_5a[0]===_58[1][0]&&_5a[1]===_58[1][1])||(_5a[0]===_59[1][0]&&_5a[1]===_59[1][1]))){return true;}}}}}var _5c=_57.rings[k].length;if(_5c<=4){continue;}for(i=0;i<_5c-3;i++){var _5d=_5c-1;if(i===0){_5d=_5c-2;}_58=[[_57.rings[k][i][0],_57.rings[k][i][1]],[_57.rings[k][i+1][0],_57.rings[k][i+1][1]]];for(j=i+2;j<_5d;j++){_59=[[_57.rings[k][j][0],_57.rings[k][j][1]],[_57.rings[k][j+1][0],_57.rings[k][j+1][1]]];_5a=esri.geometry._getLineIntersection2(_58,_59);if(_5a){if(!((_5a[0]===_58[0][0]&&_5a[1]===_58[0][1])||(_5a[0]===_59[0][0]&&_5a[1]===_59[0][1])||(_5a[0]===_58[1][0]&&_5a[1]===_58[1][1])||(_5a[0]===_59[1][0]&&_5a[1]===_59[1][1]))){return true;}}}}}return false;};EG.createCircle=function(_5e){var _5f={center:_5e.center,longAxis:_5e.r,shortAxis:_5e.r,numberOfPoints:_5e.numberOfPoints,map:_5e.map};var _60=EG.createEllipse(_5f);return _60;};EG.createEllipse=function(_61){var dx=_61.center.x,dy=_61.center.y,a=_61.longAxis,b=_61.shortAxis,_62=_61.numberOfPoints,map=_61.map,pt,i,_63,_64,_65,_66=[],_67=(2*Math.PI)/_62;for(i=0;i<_62;i++){_63=Math.cos(i*_67);_64=Math.sin(i*_67);pt=map.toMap({x:a*_63+dx,y:b*_64+dy});_66.push(pt);}_66.push(_66[0]);_65=new esri.geometry.Polygon(map.spatialReference);_65.addRing(_66);return _65;};EG._foldCutResults=function(_68,_69){var _6a=-1;_2.forEach(_69.cutIndexes,function(_6b,i){var _6c=_69.geometries[i];var _6d=_6c.rings||_6c.paths;_2.forEach(_6d,function(_6e,_6f){_2.some(_6e,function(_70){if(_70[0]<180){return true;}else{var _71=0,j,jl=_6e.length,ptX;for(j=0;j<jl;j++){ptX=_6e[j][0];_71=ptX>_71?ptX:_71;}var _72=EG._offsetMagnitude(_71,180),_73=_72*-360,_74,_75=_6e.length;for(_74=0;_74<_75;_74++){var _76=_6c.getPoint(_6f,_74);_6c.setPoint(_6f,_74,_76.offset(_73,0));}return true;}});});if(_6b===_6a){if(_6c.rings){_2.forEach(_6c.rings,function(_77,j){_68[_6b]=_68[_6b].addRing(_77);});}else{_2.forEach(_6c.paths,function(_78,j){_68[_6b]=_68[_6b].addPath(_78);});}}else{_6a=_6b;_68[_6b]=_6c;}});return _68;};EG._prepareGeometryForCut=function(_79,_7a,_7b){var _7c=1000000;if(_7a){var _7d=EG._straightLineDensify(_79,_7c);_79=EG.webMercatorToGeographic(_7d,true);}if(_7b){_79=EG._updatePolyGeometry(_79,_7b);}return _79;};EG._offsetMagnitude=function(_7e,_7f){return Math.ceil((_7e-_7f)/(_7f*2));};EG._pointNormalization=function(_80,_81,_82){var _83=_80.x||_80[0];var _84;if(_83>_81){_84=EG._offsetMagnitude(_83,_81);if(_80.x){_80=_80.offset(_84*(-2*_81),0);}else{_80[0]=_83+(_84*(-2*_81));}}else{if(_83<_82){_84=EG._offsetMagnitude(_83,_82);if(_80.x){_80=_80.offset(_84*(-2*_82),0);}else{_80[0]=_83+(_84*(-2*_82));}}}return _80;};EG._updatePolyGeometry=function(_85,_86){var _87=_85.paths||_85.rings,i,j,il=_87.length,jl;for(i=0;i<il;i++){var _88=_87[i];jl=_88.length;for(j=0;j<jl;j++){var _89=_85.getPoint(i,j);_85.setPoint(i,j,_89.offset(_86,0));}}return _85;};EG._straightLineDensify=function(_8a,_8b){if(!(_8a instanceof esri.geometry.Polyline||_8a instanceof esri.geometry.Polygon)){var msg="_straightLineDensify: the input geometry is neither polyline nor polygon";console.error(msg);throw new Error(msg);}var _8c=_8a instanceof esri.geometry.Polyline,_8d=_8c?_8a.paths:_8a.rings,_8e=[],_8f;_2.forEach(_8d,function(_90){_8e.push(_8f=[]);_8f.push([_90[0][0],_90[0][1]]);var x1,y1,x2,y2;var i,j,_91,_92,_93,_94,xj,yj;for(i=0;i<_90.length-1;i++){x1=_90[i][0];y1=_90[i][1];x2=_90[i+1][0];y2=_90[i+1][1];_91=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));_92=(y2-y1)/_91;_93=(x2-x1)/_91;_94=_91/_8b;if(_94>1){for(j=1;j<=_94-1;j++){var _95=j*_8b;xj=_93*_95+x1;yj=_92*_95+y1;_8f.push([xj,yj]);}var _96=(_91+Math.floor(_94-1)*_8b)/2;xj=_93*_96+x1;yj=_92*_96+y1;_8f.push([xj,yj]);}_8f.push([x2,y2]);}});if(_8c){return new esri.geometry.Polyline({paths:_8e,spatialReference:_8a.spatialReference});}else{return new esri.geometry.Polygon({rings:_8e,spatialReference:_8a.spatialReference});}};EG._unitsDictionary={"esriMiles":1,"esriKilometers":1.609344,"esriFeet":5280,"esriMeters":1609.34,"esriYards":1760,"esriNauticalMiles":0.869,"esriCentimeters":160934,"esriDecimeters":16093.4,"esriInches":63360,"esriMillimeters":1609340,"esriAcres":1,"esriAres":40.4685642,"esriSquareKilometers":0.00404685642,"esriSquareMiles":0.0015625,"esriSquareFeet":43560,"esriSquareMeters":4046.85642,"esriHectares":0.404685642,"esriSquareYards":4840,"esriSquareInches":6272640,"esriSquareMillimeters":4046856420,"esriSquareCentimeters":40468564.2,"esriSquareDecimeters":404685.642};EG._toEqualAreaPoint=function(pt){var _97=Math.PI/180;var a=6378137;var eSq=0.006694379990197414,e=0.0818191908429643;var _98=Math.sin(pt.y*_97);var q=(1-eSq)*((_98/(1-eSq*(_98*_98))-(1/(2*e))*Math.log((1-e*_98)/(1+e*_98))));var x=a*pt.x*_97;var y=a*q*0.5;var _99=new esri.geometry.Point(x,y);return _99;};EG._directGeodeticSolver=function(_9a,_9b,_9c,s){var a=6378137,b=6356752.31424518,f=1/298.257223563;var _9d=Math.sin(_9c);var _9e=Math.cos(_9c);var _9f=(1-f)*Math.tan(_9a);var _a0=1/Math.sqrt((1+_9f*_9f)),_a1=_9f*_a0;var _a2=Math.atan2(_9f,_9e);var _a3=_a0*_9d;var _a4=1-_a3*_a3;var uSq=_a4*(a*a-b*b)/(b*b);var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));var _a5=s/(b*A),_a6=2*Math.PI;var _a7,_a8,_a9;while(Math.abs(_a5-_a6)>1e-12){_a9=Math.cos(2*_a2+_a5);_a7=Math.sin(_a5);_a8=Math.cos(_a5);var _aa=B*_a7*(_a9+B/4*(_a8*(-1+2*_a9*_a9)-B/6*_a9*(-3+4*_a7*_a7)*(-3+4*_a9*_a9)));_a6=_a5;_a5=s/(b*A)+_aa;}var tmp=_a1*_a7-_a0*_a8*_9e;var _ab=Math.atan2(_a1*_a8+_a0*_a7*_9e,(1-f)*Math.sqrt(_a3*_a3+tmp*tmp));var _ac=Math.atan2(_a7*_9d,_a0*_a8-_a1*_a7*_9e);var C=f/16*_a4*(4+f*(4-3*_a4));var L=_ac-(1-C)*f*_a3*(_a5+C*_a7*(_a9+C*_a8*(-1+2*_a9*_a9)));var _ad=_ab/(Math.PI/180);var _ae=(_9b+L)/(Math.PI/180);var pt=new esri.geometry.Point(_ae,_ad,new esri.SpatialReference({wkid:4326}));return pt;};EG._inverseGeodeticSolver=function(_af,_b0,_b1,_b2){var a=6378137,b=6356752.31424518,f=1/298.257223563;var L=(_b2-_b0);var U1=Math.atan((1-f)*Math.tan(_af));var U2=Math.atan((1-f)*Math.tan(_b1));var _b3=Math.sin(U1),_b4=Math.cos(U1);var _b5=Math.sin(U2),_b6=Math.cos(U2);var _b7=L,_b8,_b9=1000;var _ba,_bb,_bc,_bd,_be;do{var _bf=Math.sin(_b7),_c0=Math.cos(_b7);_bb=Math.sqrt((_b6*_bf)*(_b6*_bf)+(_b4*_b5-_b3*_b6*_c0)*(_b4*_b5-_b3*_b6*_c0));if(_bb===0){return 0;}_bd=_b3*_b5+_b4*_b6*_c0;_be=Math.atan2(_bb,_bd);var _c1=_b4*_b6*_bf/_bb;_ba=1-_c1*_c1;_bc=_bd-2*_b3*_b5/_ba;if(isNaN(_bc)){_bc=0;}var C=f/16*_ba*(4+f*(4-3*_ba));_b8=_b7;_b7=L+(1-C)*f*_c1*(_be+C*_bb*(_bc+C*_bd*(-1+2*_bc*_bc)));}while(Math.abs(_b7-_b8)>1e-12&&--_b9>0);if(_b9===0){var _c2=6371009;var _c3=Math.acos(Math.sin(_af)*Math.sin(_b1)+Math.cos(_af)*Math.cos(_b1)*Math.cos(_b2-_b0))*_c2;var _c4=_b2-_b0;var y=Math.sin(_c4)*Math.cos(_b1);var x=Math.cos(_af)*Math.sin(_b1)-Math.sin(_af)*Math.cos(_b1)*Math.cos(_c4);var _c5=Math.atan2(y,x);return {"azimuth":_c5,"geodesicDistance":_c3};}var uSq=_ba*(a*a-b*b)/(b*b);var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));var _c6=B*_bb*(_bc+B/4*(_bd*(-1+2*_bc*_bc)-B/6*_bc*(-3+4*_bb*_bb)*(-3+4*_bc*_bc)));var s=b*A*(_be-_c6);var _c7=Math.atan2(_b6*Math.sin(_b7),_b4*_b5-_b3*_b6*Math.cos(_b7));var _c8=Math.atan2(_b4*Math.sin(_b7),_b4*_b5*Math.cos(_b7)-_b3*_b6);var _c9={azimuth:_c7,geodesicDistance:s,reverseAzimuth:_c8};return _c9;};}());});