//>>built
define("dgrid/OnDemandList",["./List","./_StoreMixin","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/on","./util/misc","put-selector/put"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _3("dgrid.OnDemandList",[_1,_2],{minRowsPerPage:25,maxRowsPerPage:100,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:10000,rowHeight:22,queryRowsOverlap:1,pagingDelay:_7.defaultDelay,postCreate:function(){this.inherited(arguments);var _9=this;_6(this.bodyNode,"scroll",_7.throttleDelayed(function(_a){_9._processScroll(_a);},null,this.pagingDelay));},renderQuery:function(_b,_c){var _d={query:_b,count:0,node:_c};if(!_c){var _e=true;var _f={node:_8(this.contentNode,"div.dgrid-preload",{rowIndex:0}),count:0,query:_b,next:_d};_d.node=_c=_8(this.contentNode,"div.dgrid-preload");_d.previous=_f;}_c.rowIndex=this.minRowsPerPage;var _10=this.preload;if(_10){if((_d.next=_10.next)&&this.bodyNode.scrollTop>=_10.node.offsetTop){_d.previous=_10;}else{_d.next=_10;_d.previous=_10.previous;}_d.previous.next=_d;_d.next.previous=_d;}else{this.preload=_d;}var _11=_8(_c,"-div.dgrid-loading");_8(_11,"div.dgrid-below",this.loadingMessage);var _12=_4.mixin(this.get("queryOptions"),{start:0,count:this.minRowsPerPage,query:_b});var _13=_b(_12);var _14=this;_5.when(this.renderArray(_13,_c,_12),function(trs){return _5.when(_13.total||_13.length,function(_15){_8(_11,"!");var _16=trs.length;_15=_15||_16;if(!_15){_8(_14.contentNode,"div.dgrid-no-data").innerHTML=_14.noDataMessage;}var _17=0;for(var i=0;i<_16;i++){_17+=trs[i].offsetHeight;}if(_16&&_17){_14.rowHeight=_17/_16;}_15-=_16;_d.count=_15;_c.rowIndex=_16;if(_15){_c.style.height=Math.min(_15*_14.rowHeight,_14.maxEmptySpace)+"px";}else{_c.style.display="none";}_14._processScroll();return trs;});});return _13;},refresh:function(){this.inherited(arguments);if(this.store){var _18=this;this._trackError(function(){return _18.renderQuery(function(_19){return _18.store.query(_18.query,_19);});});}},_calcRowHeight:function(_1a){return _1a.offsetHeight;},lastScrollTop:0,_processScroll:function(){var _1b=this,_1c=_1b.bodyNode,_1d=_1b.contentNode.style.webkitTransform,_1e=_1c.scrollTop+(_1d?-_1d.match(/translate[\w]*\(.*?,(.*?)px/)[1]:0),_1f=_1c.offsetHeight+_1e,_20,_21,_22=_1b.preload,_23=_1b.lastScrollTop,_24=_1b.bufferRows*_1b.rowHeight,_25=_24-_1b.rowHeight;var _26=1;_1b.lastScrollTop=_1e;function _27(_28,_29,_2a,_2b){var _2c=_1b.farOffRemoval,_21=_28.node;if(_29>2*_2c){var row,_2d=_21[_2a];var _2e=0;var _2f=0;var _30=[];while((row=_2d)){var _31=_1b._calcRowHeight(row);if(_2e+_31+_2c>_29||(_2d.className.indexOf("dgrid-row")<0&&_2d.className.indexOf("dgrid-loading")<0)){break;}var _2d=row[_2a];var _32,_33=row.observerIndex;if(_33!=_32&&_32>-1){var _34=_1b.observers;var _35=_34[_32];_35&&_35.cancel();_34[_32]=0;}_2e+=_31;_2f+=row.count||1;_32=_33;_1b.removeRow(row,true);delete _1b._rowIdToObject[row.id];_30.push(row);}_28.count+=_2f;if(_2b){_21.rowIndex-=_2f;_36(_28);}else{_21.style.height=(_21.offsetHeight+_2e)+"px";}var _37=_8("div");for(var i=0;i<_30.length;i++){_8(_37,_30[i]);}setTimeout(function(){_8(_37,"!");},1);}};function _36(_38,_39){_38.node.style.height=Math.min(_38.count*_1b.rowHeight,_39?Infinity:_1b.maxEmptySpace)+"px";};while(_22&&_22!=_20){_20=_1b.preload;_1b.preload=_22;_21=_22.node;var _3a=_21.offsetTop;var _3b;if(_1f+_26+_25<_3a){do{_22=_22.previous;}while(_22&&!_22.node.offsetWidth);}else{if(_1e-_26-_25>(_3a+(_3b=_21.offsetHeight))){do{_22=_22.next;}while(_22&&!_22.node.offsetWidth);}else{var _3c=((_21.rowIndex?_1e-_24:_1f)-_3a)/_1b.rowHeight;var _3d=(_1f-_1e+2*_24)/_1b.rowHeight;var _3e=Math.max(Math.min((_1e-_23)*_1b.rowHeight,_1b.maxRowsPerPage/2),_1b.maxRowsPerPage/-2);_3d+=Math.min(Math.abs(_3e),10);if(_21.rowIndex==0){_3c-=_3d;}_3c=Math.max(_3c,0);if(_3c<10&&_3c>0&&_3d+_3c<_1b.maxRowsPerPage){_3d+=Math.max(0,_3c);_3c=0;}_3d=Math.min(Math.max(_3d,_1b.minRowsPerPage),_1b.maxRowsPerPage,_22.count);if(_3d==0){return;}_3d=Math.ceil(_3d);_3c=Math.min(Math.floor(_3c),_22.count-_3d);var _3f=_1b.get("queryOptions");_22.count-=_3d;var _40=_21,_41,_42=_1b.queryRowsOverlap,_43=_21.rowIndex>0&&_22;if(_43){var _44=_22.previous;if(_44){_27(_44,_1e-(_44.node.offsetTop+_44.node.offsetHeight),"nextSibling");if(_3c>0&&_44.node==_21.previousSibling){_3c=Math.min(_22.count,_3c);_22.previous.count+=_3c;_36(_22.previous,true);_22.count-=_3c;_21.rowIndex+=_3c;_42=0;}else{_3d+=_3c;}}_3f.start=_21.rowIndex-_42;_21.rowIndex+=_3d;}else{if(_22.next){_27(_22.next,_22.next.node.offsetTop-_1f,"previousSibling",true);var _40=_21.nextSibling;if(_40==_22.next.node){_22.next.count+=_22.count-_3c;_22.next.node.rowIndex=_3c+_3d;_22.count=_3c;_42=0;}else{_41=true;}}_3f.start=_22.count;}_3f.count=_3d+_42;if(_41){_41=_40.offsetTop;}_36(_22);var _45=_8(_40,"-div.dgrid-loading[style=height:"+_3d*_1b.rowHeight+"px]");_8(_45,"div.dgrid-"+(_43?"below":"above"),_1b.loadingMessage);_45.count=_3d;_3f.query=_22.query;var _46=_22.query(_3f),_47=_1b._trackError(function(){return _46;});if(_47===undefined){return;}(function(_48,_49,_4a,_4b,_4c){_5.when(_1b.renderArray(_4c,_48,_3f),function(){_40=_48.nextSibling;_8(_48,"!");if(_4b&&_40){_49.scrollTop+=_40.offsetTop-_4b;}if(_4a){_5.when(_4c.total||_4c.length,function(_4d){_4a.count=_4d-_4a.node.rowIndex;_36(_4a);});}});}).call(this,_45,_1c,_43,_41,_46);_22=_22.previous;}}}}});});