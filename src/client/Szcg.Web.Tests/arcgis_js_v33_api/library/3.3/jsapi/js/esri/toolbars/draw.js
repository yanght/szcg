/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define("esri/toolbars/draw",["dijit","dojo","dojox","dojo/require!esri/toolbars/_toolbar,esri/geometry,esri/symbol,esri/utils"],function(_1,_2,_3){_2.provide("esri.toolbars.draw");_2.require("esri.toolbars._toolbar");_2.require("esri.geometry");_2.require("esri.symbol");_2.require("esri.utils");_2.declare("esri.toolbars.Draw",esri.toolbars._Toolbar,{constructor:function(_4,_5){this.markerSymbol=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SOLID,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([255,0,0]),2),new _2.Color([0,0,0,0.25]));this.lineSymbol=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([255,0,0]),2);this.fillSymbol=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([255,0,0]),2),new _2.Color([0,0,0,0.25]));this._points=[];this._defaultOptions={showTooltips:true,drawTime:75,tolerance:8,tooltipOffset:15};this._options=_2.mixin(_2.mixin({},this._defaultOptions),_5||{});if(esri.isTouchEnabled){this._options.showTooltips=false;}this._onKeyDownHandler=_2.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=_2.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=_2.hitch(this,this._onMouseUpHandler);this._onClickHandler=_2.hitch(this,this._onClickHandler);this._onMouseMoveHandler=_2.hitch(this,this._onMouseMoveHandler);this._onMouseDragHandler=_2.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=_2.hitch(this,this._onDblClickHandler);this._updateTooltip=_2.hitch(this,this._updateTooltip);this._hideTooltip=_2.hitch(this,this._hideTooltip);this._redrawGraphic=_2.hitch(this,this._redrawGraphic);},_geometryType:null,respectDrawingVertexOrder:false,setRespectDrawingVertexOrder:function(_6){this.respectDrawingVertexOrder=_6;},setMarkerSymbol:function(_7){this.markerSymbol=_7;},setLineSymbol:function(_8){this.lineSymbol=_8;},setFillSymbol:function(_9){this.fillSymbol=_9;},activate:function(_a,_b){if(this._geometryType){this.deactivate();}var _c=this.map,dc=_2.connect,_d=esri.toolbars.Draw;this._options=_2.mixin(_2.mixin({},this._options),_b||{});_c.navigationManager.setImmediateClick(false);switch(_a){case _d.ARROW:case _d.LEFT_ARROW:case _d.RIGHT_ARROW:case _d.UP_ARROW:case _d.DOWN_ARROW:case _d.TRIANGLE:case _d.CIRCLE:case _d.ELLIPSE:case _d.RECTANGLE:this._deactivateMapTools(true,false,false,true);this._onClickHandler_connect=dc(_c,"onClick",this._onClickHandler);this._onMouseDownHandler_connect=dc(_c,esri.isTouchEnabled?"onSwipeStart":"onMouseDown",this._onMouseDownHandler);this._onMouseDragHandler_connect=dc(_c,esri.isTouchEnabled?"onSwipeMove":"onMouseDrag",this._onMouseDragHandler);this._onMouseUpHandler_connect=dc(_c,esri.isTouchEnabled?"onSwipeEnd":"onMouseUp",this._onMouseUpHandler);break;case _d.POINT:this._onClickHandler_connect=dc(_c,"onClick",this._onClickHandler);break;case _d.LINE:case _d.EXTENT:case _d.FREEHAND_POLYLINE:case _d.FREEHAND_POLYGON:this._deactivateMapTools(true,false,false,true);this._onMouseDownHandler_connect=dc(_c,esri.isTouchEnabled?"onSwipeStart":"onMouseDown",this._onMouseDownHandler);this._onMouseDragHandler_connect=dc(_c,esri.isTouchEnabled?"onSwipeMove":"onMouseDrag",this._onMouseDragHandler);this._onMouseUpHandler_connect=dc(_c,esri.isTouchEnabled?"onSwipeEnd":"onMouseUp",this._onMouseUpHandler);break;case _d.POLYLINE:case _d.POLYGON:case _d.MULTI_POINT:_c.navigationManager.setImmediateClick(true);this._onClickHandler_connect=dc(_c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=dc(_c,"onDblClick",this._onDblClickHandler);_c.disableDoubleClickZoom();break;default:console.error(esri.bundle.toolbars.draw.invalidType+": "+_a);return;}this._onKeyDown_connect=dc(_c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=dc(_c,"onExtentChange",this._redrawGraphic);this._geometryType=_a;this._toggleTooltip(true);if(_c.snappingManager&&this._geometryType!=="freehandpolyline"&&this._geometryType!=="freehandpolygon"&&!esri.isTouchEnabled){_c.snappingManager._startSelectionLayerQuery();_c.snappingManager._setUpSnapping();}this.onActivate(this._geometryType);},deactivate:function(){var _e=this.map;this._clear();var _f=_2.disconnect;_f(this._onMouseDownHandler_connect);_f(this._onMouseMoveHandler_connect);_f(this._onMouseDragHandler_connect);_f(this._onMouseUpHandler_connect);_f(this._onClickHandler_connect);_f(this._onDblClickHandler_connect);_f(this._onKeyDown_connect);_f(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;if(_e.snappingManager){_e.snappingManager._stopSelectionLayerQuery();_e.snappingManager._killOffSnapping();}switch(this._geometryType){case esri.toolbars.Draw.CIRCLE:case esri.toolbars.Draw.ELLIPSE:case esri.toolbars.Draw.TRIANGLE:case esri.toolbars.Draw.ARROW:case esri.toolbars.Draw.LEFT_ARROW:case esri.toolbars.Draw.RIGHT_ARROW:case esri.toolbars.Draw.UP_ARROW:case esri.toolbars.Draw.DOWN_ARROW:case esri.toolbars.Draw.RECTANGLE:case esri.toolbars.Draw.LINE:case esri.toolbars.Draw.EXTENT:case esri.toolbars.Draw.FREEHAND_POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYGON:this._activateMapTools(true,false,false,true);break;case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.POLYGON:case esri.toolbars.Draw.MULTI_POINT:_e.enableDoubleClickZoom();break;}var _10=this._geometryType;this._geometryType=null;_e.navigationManager.setImmediateClick(false);this._toggleTooltip(false);this.onDeactivate(_10);},_clear:function(){if(this._graphic){this.map.graphics.remove(this._graphic,true);}if(this._tGraphic){this.map.graphics.remove(this._tGraphic,true);}this._graphic=this._tGraphic=null;if(this.map.snappingManager){this.map.snappingManager._setGraphic(null);}this._points=[];},finishDrawing:function(){var _11,_12=this._points,map=this.map,_13=map.spatialReference,_14=esri.toolbars.Draw;_12=_12.slice(0,_12.length);switch(this._geometryType){case _14.POLYLINE:if(!this._graphic||_12.length<2){return;}_11=new esri.geometry.Polyline(_13);_11.addPath([].concat(_12));break;case _14.POLYGON:if(!this._graphic||_12.length<3){return;}_11=new esri.geometry.Polygon(_13);var _15=[].concat(_12,[_12[0].offset(0,0)]);if(!esri.geometry.isClockwise(_15)&&!this.respectDrawingVertexOrder){console.debug(this.declaredClass+" : "+esri.bundle.toolbars.draw.convertAntiClockwisePolygon);_15.reverse();}_11.addRing(_15);break;case _14.MULTI_POINT:_11=new esri.geometry.Multipoint(_13);_2.forEach(_12,function(pt){_11.addPoint(pt);});break;}_2.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(_11);},_drawEnd:function(_16){if(_16){var _17=this.map.spatialReference;this.onDrawEnd(_16);this.onDrawComplete({geometry:_16,geographicGeometry:(_17&&_17.isWebMercator())?esri.geometry.webMercatorToGeographic(_16,true):null});}},_normalizeRect:function(_18,end,_19){var sx=_18.x,sy=_18.y,ex=end.x,ey=end.y,_1a=Math.abs(sx-ex),_1b=Math.abs(sy-ey);return {x:Math.min(sx,ex),y:Math.max(sy,ey),width:_1a,height:_1b,spatialReference:_19};},_onMouseDownHandler:function(evt){this._dragged=false;var _1c;if(this.map.snappingManager){_1c=this.map.snappingManager._snappingPoint;}var _1d=_1c||evt.mapPoint,_1e=esri.toolbars.Draw,map=this.map,_1f=map.spatialReference;this._points.push(_1d.offset(0,0));switch(this._geometryType){case _1e.LINE:this._graphic=map.graphics.add(new esri.Graphic(new esri.geometry.Polyline({paths:[[[_1d.x,_1d.y],[_1d.x,_1d.y]]],spatialReference:_1f}),this.lineSymbol),true);if(map.snappingManager){map.snappingManager._setGraphic(this._graphic);}break;case _1e.EXTENT:break;case _1e.FREEHAND_POLYLINE:this._oldPoint=evt.screenPoint;var _20=new esri.geometry.Polyline(_1f);_20.addPath(this._points);this._graphic=map.graphics.add(new esri.Graphic(_20,this.lineSymbol),true);if(map.snappingManager){map.snappingManager._setGraphic(this._graphic);}break;case _1e.CIRCLE:case _1e.ELLIPSE:case _1e.TRIANGLE:case _1e.ARROW:case _1e.LEFT_ARROW:case _1e.RIGHT_ARROW:case _1e.UP_ARROW:case _1e.DOWN_ARROW:case _1e.RECTANGLE:case _1e.FREEHAND_POLYGON:this._oldPoint=evt.screenPoint;var _21=new esri.geometry.Polygon(_1f);_21.addRing(this._points);this._graphic=map.graphics.add(new esri.Graphic(_21,this.fillSymbol),true);if(map.snappingManager){map.snappingManager._setGraphic(this._graphic);}break;}if(esri.isTouchEnabled){evt.preventDefault();}},_onMouseMoveHandler:function(evt){var _22;if(this.map.snappingManager){_22=this.map.snappingManager._snappingPoint;}var _23=this._points[this._points.length-1],end=_22||evt.mapPoint,_24=this._tGraphic,_25=_24.geometry;switch(this._geometryType){case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.POLYGON:_25.setPoint(0,0,{x:_23.x,y:_23.y});_25.setPoint(0,1,{x:end.x,y:end.y});_24.setGeometry(_25);break;}},_onMouseDragHandler:function(evt){if(esri.isTouchEnabled&&!this._points.length){evt.preventDefault();return;}this._dragged=true;var _26;if(this.map.snappingManager){_26=this.map.snappingManager._snappingPoint;}var _27=this._points[0],end=_26||evt.mapPoint,map=this.map,_28=map.spatialReference,_29=this._graphic,_2a=esri.toolbars.Draw,_2b=map.toScreen(_27),_2c=map.toScreen(end),pts=[],a=_2c.x-_2b.x,b=_2c.y-_2b.y,_2d=60,d=Math.sqrt(a*a+b*b);switch(this._geometryType){case _2a.CIRCLE:this._hideTooltip();_29.geometry=esri.geometry.createCircle({center:_2b,r:d,numberOfPoints:_2d,map:map});_29.setGeometry(_29.geometry);break;case _2a.ELLIPSE:this._hideTooltip();_29.geometry=esri.geometry.createEllipse({center:_2b,longAxis:a,shortAxis:b,numberOfPoints:_2d,map:map});_29.setGeometry(_29.geometry);break;case _2a.TRIANGLE:this._hideTooltip();pts=[[0,-d],[0.8660254037844386*d,0.5*d],[-0.8660254037844386*d,0.5*d],[0,-d]];_29.geometry=this._toPolygon(pts,_2b.x,_2b.y);_29.setGeometry(_29.geometry);break;case _2a.ARROW:this._hideTooltip();var _2e=b/d,_2f=a/d,_30=b/a;var f=_2f*0.25*d,e=0.25*d/_30,g=_2e*0.25*d;pts=[[a,b],[a-f*(1+24/e),b+24*_2f-g],[a-f*(1+12/e),b+12*_2f-g],[-12*_2e,12*_2f],[12*_2e,-12*_2f],[a-f*(1-12/e),b-12*_2f-g],[a-f*(1-24/e),b-24*_2f-g],[a,b]];_29.geometry=this._toPolygon(pts,_2b.x,_2b.y);_29.setGeometry(_29.geometry);break;case _2a.LEFT_ARROW:this._hideTooltip();if(a<=0){pts=[[a,0],[0.75*a,b],[0.75*a,0.5*b],[0,0.5*b],[0,-0.5*b],[0.75*a,-0.5*b],[0.75*a,-b],[a,0]];}else{pts=[[0,0],[0.25*a,b],[0.25*a,0.5*b],[a,0.5*b],[a,-0.5*b],[0.25*a,-0.5*b],[0.25*a,-b],[0,0]];}_29.geometry=this._toPolygon(pts,_2b.x,_2b.y);_29.setGeometry(_29.geometry);break;case _2a.RIGHT_ARROW:this._hideTooltip();if(a>=0){pts=[[a,0],[0.75*a,b],[0.75*a,0.5*b],[0,0.5*b],[0,-0.5*b],[0.75*a,-0.5*b],[0.75*a,-b],[a,0]];}else{pts=[[0,0],[0.25*a,b],[0.25*a,0.5*b],[a,0.5*b],[a,-0.5*b],[0.25*a,-0.5*b],[0.25*a,-b],[0,0]];}_29.geometry=this._toPolygon(pts,_2b.x,_2b.y);_29.setGeometry(_29.geometry);break;case _2a.UP_ARROW:this._hideTooltip();if(b<=0){pts=[[0,b],[-a,0.75*b],[-0.5*a,0.75*b],[-0.5*a,0],[0.5*a,0],[0.5*a,0.75*b],[a,0.75*b],[0,b]];}else{pts=[[0,0],[-a,0.25*b],[-0.5*a,0.25*b],[-0.5*a,b],[0.5*a,b],[0.5*a,0.25*b],[a,0.25*b],[0,0]];}_29.geometry=this._toPolygon(pts,_2b.x,_2b.y);_29.setGeometry(_29.geometry);break;case _2a.DOWN_ARROW:this._hideTooltip();if(b>=0){pts=[[0,b],[-a,0.75*b],[-0.5*a,0.75*b],[-0.5*a,0],[0.5*a,0],[0.5*a,0.75*b],[a,0.75*b],[0,b]];}else{pts=[[0,0],[-a,0.25*b],[-0.5*a,0.25*b],[-0.5*a,b],[0.5*a,b],[0.5*a,0.25*b],[a,0.25*b],[0,0]];}_29.geometry=this._toPolygon(pts,_2b.x,_2b.y);_29.setGeometry(_29.geometry);break;case _2a.RECTANGLE:this._hideTooltip();pts=[[0,0],[a,0],[a,b],[0,b],[0,0]];_29.geometry=this._toPolygon(pts,_2b.x,_2b.y);_29.setGeometry(_29.geometry);break;case _2a.LINE:_29.setGeometry(_2.mixin(_29.geometry,{paths:[[[_27.x,_27.y],[end.x,end.y]]]}));break;case _2a.EXTENT:if(_29){map.graphics.remove(_29,true);}var _31=new esri.geometry.Rect(this._normalizeRect(_27,end,_28));_31._originOnly=true;this._graphic=map.graphics.add(new esri.Graphic(_31,this.fillSymbol),true);if(map.snappingManager){map.snappingManager._setGraphic(this._graphic);}break;case _2a.FREEHAND_POLYLINE:this._hideTooltip();if(this._canDrawFreehandPoint(evt)===false){if(esri.isTouchEnabled){evt.preventDefault();}return;}this._points.push(evt.mapPoint.offset(0,0));_29.geometry._insertPoints([end.offset(0,0)],0);_29.setGeometry(_29.geometry);break;case _2a.FREEHAND_POLYGON:this._hideTooltip();if(this._canDrawFreehandPoint(evt)===false){if(esri.isTouchEnabled){evt.preventDefault();}return;}this._points.push(evt.mapPoint.offset(0,0));_29.geometry._insertPoints([end.offset(0,0)],0);_29.setGeometry(_29.geometry);break;}if(esri.isTouchEnabled){evt.preventDefault();}},_canDrawFreehandPoint:function(evt){if(!this._oldPoint){return false;}var dx=this._oldPoint.x-evt.screenPoint.x;dx=(dx<0)?dx*-1:dx;var dy=this._oldPoint.y-evt.screenPoint.y;dy=(dy<0)?dy*-1:dy;var _32=this._options.tolerance;if(dx<_32&&dy<_32){return false;}var now=new Date();var _33=now-this._startTime;if(_33<this._options.drawTime){return false;}this._startTime=now;this._oldPoint=evt.screenPoint;return true;},_onMouseUpHandler:function(evt){if(!this._dragged){this._clear();return;}if(this._points.length===0){this._points.push(evt.mapPoint.offset(0,0));}var _34;if(this.map.snappingManager){_34=this.map.snappingManager._snappingPoint;}var _35=this._points[0],end=_34||evt.mapPoint,map=this.map,_36=map.spatialReference,_37=esri.toolbars.Draw,_38;switch(this._geometryType){case _37.CIRCLE:case _37.ELLIPSE:case _37.TRIANGLE:case _37.ARROW:case _37.LEFT_ARROW:case _37.RIGHT_ARROW:case _37.UP_ARROW:case _37.DOWN_ARROW:case _37.RECTANGLE:_38=this._graphic.geometry;break;case _37.LINE:_38=new esri.geometry.Polyline({paths:[[[_35.x,_35.y],[end.x,end.y]]],spatialReference:_36});break;case _37.EXTENT:_38=esri.geometry._rectToExtent(new esri.geometry.Rect(this._normalizeRect(_35,end,_36)));break;case _37.FREEHAND_POLYLINE:_38=new esri.geometry.Polyline(_36);_38.addPath([].concat(this._points,[end.offset(0,0)]));break;case _37.FREEHAND_POLYGON:_38=new esri.geometry.Polygon(_36);var _39=[].concat(this._points,[end.offset(0,0),this._points[0].offset(0,0)]);if(!esri.geometry.isClockwise(_39)&&!this.respectDrawingVertexOrder){console.debug(this.declaredClass+" : "+esri.bundle.toolbars.draw.convertAntiClockwisePolygon);_39.reverse();}_38.addRing(_39);break;}if(esri.isTouchEnabled){evt.preventDefault();}this._clear();this._drawEnd(_38);},_onClickHandler:function(evt){var _3a;if(this.map.snappingManager){_3a=this.map.snappingManager._snappingPoint;}var _3b=_3a||evt.mapPoint,map=this.map,_3c=map.toScreen(_3b),_3d=esri.toolbars.Draw,pts,dx,dy,_3e,_3f,_40;this._points.push(_3b.offset(0,0));switch(this._geometryType){case _3d.POINT:this._drawEnd(_3b.offset(0,0));this._setTooltipMessage(0);break;case _3d.POLYLINE:if(this._points.length===1){var _41=new esri.geometry.Polyline(map.spatialReference);_41.addPath(this._points);this._graphic=map.graphics.add(new esri.Graphic(_41,this.lineSymbol),true);if(map.snappingManager){map.snappingManager._setGraphic(this._graphic);}this._onMouseMoveHandler_connect=_2.connect(map,"onMouseMove",this._onMouseMoveHandler);this._tGraphic=map.graphics.add(new esri.Graphic(new esri.geometry.Polyline({paths:[[[_3b.x,_3b.y],[_3b.x,_3b.y]]],spatialReference:map.spatialReference}),this.lineSymbol),true);}else{this._graphic.geometry._insertPoints([_3b.offset(0,0)],0);this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol);_3e=this._tGraphic;_3f=_3e.geometry;_3f.setPoint(0,0,_3b.offset(0,0));_3f.setPoint(0,1,_3b.offset(0,0));_3e.setGeometry(_3f);}break;case _3d.POLYGON:if(this._points.length===1){_40=new esri.geometry.Polygon(map.spatialReference);_40.addRing(this._points);this._graphic=map.graphics.add(new esri.Graphic(_40,this.fillSymbol),true);if(map.snappingManager){map.snappingManager._setGraphic(this._graphic);}this._onMouseMoveHandler_connect=_2.connect(map,"onMouseMove",this._onMouseMoveHandler);this._tGraphic=map.graphics.add(new esri.Graphic(new esri.geometry.Polyline({paths:[[[_3b.x,_3b.y],[_3b.x,_3b.y]]],spatialReference:map.spatialReference}),this.fillSymbol),true);}else{this._graphic.geometry._insertPoints([_3b.offset(0,0)],0);this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol);_3e=this._tGraphic;_3f=_3e.geometry;_3f.setPoint(0,0,_3b.offset(0,0));_3f.setPoint(0,1,_3b.offset(0,0));_3e.setGeometry(_3f);}break;case _3d.MULTI_POINT:var tps=this._points;if(tps.length===1){var _42=new esri.geometry.Multipoint(map.spatialReference);_42.addPoint(tps[tps.length-1]);this._graphic=map.graphics.add(new esri.Graphic(_42,this.markerSymbol),true);if(map.snappingManager){map.snappingManager._setGraphic(this._graphic);}}else{this._graphic.geometry.addPoint(tps[tps.length-1]);this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol);}break;case _3d.ARROW:pts=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]];dx=_3c.x;dy=_3c.y;this._addShape(pts,dx,dy);break;case _3d.LEFT_ARROW:pts=[[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]];dx=_3c.x;dy=_3c.y;this._addShape(pts,dx,dy);break;case _3d.RIGHT_ARROW:pts=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]];dx=_3c.x;dy=_3c.y;this._addShape(pts,dx,dy);break;case _3d.UP_ARROW:pts=[[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]];dx=_3c.x;dy=_3c.y;this._addShape(pts,dx,dy);break;case _3d.DOWN_ARROW:pts=[[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]];dx=_3c.x;dy=_3c.y;this._addShape(pts,dx,dy);break;case _3d.TRIANGLE:pts=[[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]];dx=_3c.x;dy=_3c.y;this._addShape(pts,dx,dy);break;case _3d.RECTANGLE:pts=[[0,-96],[96,-96],[96,0],[0,0],[0,-96]];dx=_3c.x-48;dy=_3c.y+48;this._addShape(pts,dx,dy);break;case _3d.CIRCLE:_40=new esri.geometry.Polygon(map.spatialReference);this._graphic=map.graphics.add(new esri.Graphic(_40,this.fillSymbol),true);this._graphic.geometry=esri.geometry.createCircle({center:_3c,r:48,numberOfPoints:60,map:map});this._graphic.setGeometry(this._graphic.geometry);this._drawEnd(this._graphic.geometry);break;case _3d.ELLIPSE:_40=new esri.geometry.Polygon(map.spatialReference);this._graphic=map.graphics.add(new esri.Graphic(_40,this.fillSymbol),true);this._graphic.geometry=esri.geometry.createEllipse({center:_3c,longAxis:48,shortAxis:24,numberOfPoints:60,map:map});this._graphic.setGeometry(this._graphic.geometry);this._drawEnd(this._graphic.geometry);break;}this._setTooltipMessage(this._points.length);},_addShape:function(_43,dx,dy){var _44=this.map.graphics.add(new esri.Graphic(this._toPolygon(_43,dx,dy),this.fillSymbol),true);this._setTooltipMessage(0);var _45;if(_44){_45=esri.geometry.fromJson(_44.geometry.toJson());this.map.graphics.remove(_44,true);}this._drawEnd(_45);_44=_45=null;},_toPolygon:function(_46,dx,dy){var map=this.map;var _47=new esri.geometry.Polygon(map.spatialReference);_47.addRing(_2.map(_46,function(pt){return map.toMap({x:pt[0]+dx,y:pt[1]+dy});}));return _47;},_onDblClickHandler:function(evt){var _48,_49=this._points,map=this.map,_4a=map.spatialReference,_4b=esri.toolbars.Draw;if(esri.isTouchEnabled){_49.push(evt.mapPoint);}_49=_49.slice(0,_49.length);switch(this._geometryType){case _4b.POLYLINE:if(!this._graphic||_49.length<2){_2.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(evt);return;}_48=new esri.geometry.Polyline(_4a);_48.addPath([].concat(_49));break;case _4b.POLYGON:if(!this._graphic||_49.length<2){_2.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(evt);return;}_48=new esri.geometry.Polygon(_4a);var _4c=[].concat(_49,[_49[0].offset(0,0)]);if(!esri.geometry.isClockwise(_4c)&&!this.respectDrawingVertexOrder){console.debug(this.declaredClass+" : "+esri.bundle.toolbars.draw.convertAntiClockwisePolygon);_4c.reverse();}_48.addRing(_4c);break;case _4b.MULTI_POINT:_48=new esri.geometry.Multipoint(_4a);_2.forEach(_49,function(pt){_48.addPoint(pt);});break;}_2.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(_48);},_onKeyDownHandler:function(evt){if(evt.keyCode===_2.keys.ESCAPE){_2.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);}},_toggleTooltip:function(_4d){if(!this._options.showTooltips){return;}if(_4d){if(this._tooltip){return;}var _4e=this.map.container;this._tooltip=_2.create("div",{"class":"tooltip"},_4e);this._tooltip.style.display="none";this._tooltip.style.position="fixed";this._setTooltipMessage(0);this._onTooltipMouseEnterHandler_connect=_2.connect(this.map,"onMouseOver",this._updateTooltip);this._onTooltipMouseLeaveHandler_connect=_2.connect(this.map,"onMouseOut",this._hideTooltip);this._onTooltipMouseMoveHandler_connect=_2.connect(this.map,"onMouseMove",this._updateTooltip);}else{if(this._tooltip){_2.disconnect(this._onTooltipMouseEnterHandler_connect);_2.disconnect(this._onTooltipMouseLeaveHandler_connect);_2.disconnect(this._onTooltipMouseMoveHandler_connect);_2.destroy(this._tooltip);this._tooltip=null;}}},_hideTooltip:function(){var _4f=this._tooltip;if(!_4f){return;}_4f.style.display="none";},_setTooltipMessage:function(_50){var _51=this._tooltip;if(!_51){return;}var _52=_50;var _53="";switch(this._geometryType){case esri.toolbars.Draw.POINT:_53=esri.bundle.toolbars.draw.addPoint;break;case esri.toolbars.Draw.ARROW:case esri.toolbars.Draw.LEFT_ARROW:case esri.toolbars.Draw.RIGHT_ARROW:case esri.toolbars.Draw.UP_ARROW:case esri.toolbars.Draw.DOWN_ARROW:case esri.toolbars.Draw.TRIANGLE:case esri.toolbars.Draw.RECTANGLE:case esri.toolbars.Draw.CIRCLE:case esri.toolbars.Draw.ELLIPSE:_53=esri.bundle.toolbars.draw.addShape;break;case esri.toolbars.Draw.LINE:case esri.toolbars.Draw.EXTENT:case esri.toolbars.Draw.FREEHAND_POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYGON:_53=esri.bundle.toolbars.draw.freehand;break;case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.POLYGON:_53=esri.bundle.toolbars.draw.start;if(_52===1){_53=esri.bundle.toolbars.draw.resume;}else{if(_52>=2){_53=esri.bundle.toolbars.draw.complete;}}break;case esri.toolbars.Draw.MULTI_POINT:_53=esri.bundle.toolbars.draw.addMultipoint;if(_52>=1){_53=esri.bundle.toolbars.draw.finish;}break;}_51.innerHTML=_53;},_updateTooltip:function(evt){var _54=this._tooltip;if(!_54){return;}var px,py;if(evt.clientX||evt.pageY){px=evt.clientX;py=evt.clientY;}else{px=evt.clientX+_2.body().scrollLeft-_2.body().clientLeft;py=evt.clientY+_2.body().scrollTop-_2.body().clientTop;}_54.style.display="none";_2.style(_54,{left:(px+this._options.tooltipOffset)+"px",top:(py)+"px"});_54.style.display="";},_redrawGraphic:function(_55,_56,_57,lod){if(_57||this.map.wrapAround180){var g=this._graphic;if(g){g.setGeometry(g.geometry);}g=this._tGraphic;if(g){g.setGeometry(g.geometry);}}},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});_2.mixin(esri.toolbars.Draw,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});});