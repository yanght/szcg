//>>built
define("dgrid/editor",["dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/aspect","dojo/has","./Grid","put-selector/put","dojo/_base/sniff"],function(_1,_2,on,_3,_4,_5,_6){var _7,_8;function _9(_a,_b){_a.value=_b;if(_a.type=="radio"||_a.type=="checkbox"){_a.checked=!!_b;}};function _c(_d,_e){if(typeof _e=="number"){_d=isNaN(_d)?_d:parseFloat(_d);}else{if(typeof _e=="boolean"){_d=_d=="true"?true:_d=="false"?false:_d;}else{if(_e instanceof Date){var _f=new Date(_d);_d=isNaN(_f.getTime())?_d:_f;}}}return _d;};function _10(_11,cmp){if(typeof cmp.get=="function"){return _c(cmp.get("value"));}else{return _c(cmp[cmp.type=="checkbox"||cmp.type=="radio"?"checked":"value"]);}};function _12(_13,_14,_15,_16){var _17,row,_18;if(!(_15>=_16&&_15<=_16)){_17=_13.cell(_14);row=_17.row;_18=_17.column;if(_18.field&&row){if(on.emit(_14,"dgrid-datachange",{grid:this,cell:_17,rowId:row.id,oldValue:_15,value:_16,bubbles:true,cancelable:true})){if(_13.updateDirty){_13.updateDirty(row.id,_18.field,_16);_18.autoSave&&setTimeout(function(){_13._trackError("save");},0);}}else{return _15;}}}return _16;};function _19(_1a,_1b,cmp){var _1c;if(!cmp.isValid||cmp.isValid()){_1c=_12(_1a,(cmp.domNode||cmp).parentNode,_7?_8:cmp._dgridLastValue,_10(_1b,cmp));if(_7){_8=_1c;}else{cmp._dgridLastValue=_1c;}}};function _1d(_1e){var _1f=_1e.editor,_20=_1e.editOn,_21=_1e.grid,_22=typeof _1f!="string",_23,cmp,_24,_25,_26;_23=_1e.editorArgs||{};if(typeof _23=="function"){_23=_23.call(_21,_1e);}if(_22){cmp=new _1f(_23);_24=cmp.focusNode||cmp.domNode;_24.className+=" dgrid-input";cmp.connect(cmp,_20?"onBlur":"onChange",function(){if(!cmp._dgridIgnoreChange){_19(_21,_1e,this);}});}else{_26=function(evt){var _27=evt.target;if("_dgridLastValue" in _27&&_27.className.indexOf("dgrid-input")>-1){_19(_21,_1e,_27);}};if(!_1e.grid._hasInputListener){_21._hasInputListener=true;_21.on("change",function(evt){_26(evt);});}_25=_1f=="textarea"?"textarea":"input[type="+_1f+"]";cmp=_24=_6(_25+".dgrid-input",_2.mixin({name:_1e.field,tabIndex:isNaN(_1e.tabIndex)?-1:_1e.tabIndex},_23));if(_4("ie")<9||(_4("ie")&&_4("quirks"))){if(_1f=="radio"||_1f=="checkbox"){on(cmp,"click",function(evt){_26(evt);});}else{on(cmp,"change",function(evt){_26(evt);});}}}on(_24,"mousedown",function(evt){evt.stopPropagation();});return cmp;};function _28(_29,_2a){var cmp=_1d(_29),_2b=cmp.domNode,_2c=cmp.domNode||cmp,_2d=cmp.focusNode||_2c,_2e=_2b?function(){cmp.set("value",cmp._dgridLastValue);}:function(){_9(cmp,cmp._dgridLastValue);_19(_29.grid,_29,cmp);},_2f;function _30(){var _31=_2c.parentNode,_32;_31.removeChild(_2c);_5.appendIfNode(_31,_2a(_29.grid.row(_31).data,_8,_31));_7=_8=null;_29._editorBlurHandle.pause();};function _33(evt){var key=evt.keyCode||evt.which;if(key==27){_2e();_8=cmp._dgridLastValue;_2d.blur();}else{if(key==13&&_29.dismissOnEnter!==false){_2d.blur();}}};_2f=on(_2d,"keydown",_33);(_29._editorBlurHandle=on.pausable(cmp,"blur",_30)).pause();return cmp;};function _34(cmp,_35,_36,_37){var _38=_35.grid,_39=_35.editor,_3a=cmp.domNode;if(!_3a){_9(cmp,_37);}_36.innerHTML="";_6(_36,cmp.domNode||cmp);if(_3a){if(!cmp._started){cmp.startup();}cmp._dgridIgnoreChange=true;cmp.set("value",_37);setTimeout(function(){cmp._dgridIgnoreChange=false;},0);}cmp._dgridLastValue=_37;if(_7){_8=_37;}};dojo.getObject("dgrid.editor",true);return (dgrid.editor=function(_3b,_3c,_3d){var _3e=_3b.renderCell||_5.defaultRenderCell,_3f,_40;_3b.editor=_3c=_3c||_3b.editor;_3b.editOn=_3d=_3d||_3b.editOn;_3f=typeof _3c!="string";if(_3b.widgetArgs){_1.deprecated("column.widgetArgs","use column.editorArgs instead","dgrid 1.0");_3b.editorArgs=_3b.widgetArgs;}_3b.renderCell=_3d?function(_41,_42,_43,_44){if(!_3b.editorInstance){_3b.editorInstance=_28(_3b,_3e);}if(!_40&&_3f){_40=true;_3.before(_3b.grid,"destroy",function(){_3b.editorInstance.destroyRecursive();});}on(_43.tagName=="TD"?_43:_43.parentNode,_3d,function(){var cmp=_3b.editorInstance,_45=_3b.grid,_46=_3b.field,row,_47,_42;if(_7!=this&&(!_3b.canEdit||_3b.canEdit(_41,_42))){_7=this;row=_45.row(_43);_47=_45.dirty&&_45.dirty[row.id];_42=(_47&&_46 in _47)?_47[_46]:_3b.get?_3b.get(row.data):row.data[_46];_34(cmp,_3b,_43,_42);setTimeout(function(){cmp.focus&&cmp.focus();_3b._editorBlurHandle&&_3b._editorBlurHandle.resume();},0);}});return _3e(_41,_42,_43,_44);}:function(_48,_49,_4a,_4b){var _4c=_3b.grid,cmp=_1d(_3b);_34(cmp,_3b,_4a,_49);if(_3f){_4a.widget=cmp;if(!_40){_40=true;_3.before(_4c,"removeRow",function(_4d){var _4e=_4c.cell(_4d,_3b.id).element,_4f=(_4e.contents||_4e).widget;_4f&&_4f.destroyRecursive();});}}};return _3b;});});