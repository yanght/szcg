//>>built
define("dgrid/_StoreMixin",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/on"],function(_1,_2,_3,_4,_5){function _6(_7){if(_5.emit(this.domNode,"dgrid-error",{error:_7,cancelable:true,bubbles:true})){console.error(_7);}};return _2("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:true,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};},_configColumn:function(_8){if(_8.set){if(!this._columnsWithSet){this._columnsWithSet={};}this._columnsWithSet[_8.field]=_8;}},_configColumns:function(){this._columnsWithSet=null;return this.inherited(arguments);},_setStore:function(_9,_a,_b){this.store=_9;this.dirty={};this.set("query",_a,_b);},_setQuery:function(_c,_d){var _e=_d&&_d.sort;this.query=_c!==undefined?_c:this.query;this.queryOptions=_d||this.queryOptions;_e?this.sort(_e):this.refresh();},setStore:function(_f,_10,_11){_1.deprecated("setStore(...)","use set(\"store\", ...) instead","dgrid 1.0");this.set("store",_f,_10,_11);},setQuery:function(_12,_13){_1.deprecated("setQuery(...)","use set(\"query\", ...) instead","dgrid 1.0");this.set("query",_12,_13);},_getQueryOptions:function(){var _14=_3.delegate(this.queryOptions,{});if(this._sort.length){_14.sort=this._sort;}return _14;},_getQuery:function(){var q=this.query;return typeof q=="object"&&q!=null?_3.delegate(q,{}):q;},_setSort:function(_15,_16){if(this.store){this._lastCollection=null;}this.inherited(arguments);},insertRow:function(_17,_18,_19,i,_1a){var _1b=this.store,_1c=this.dirty,id=_1b&&_1b.getIdentity(_17),_1d;if(id in _1c&&!(id in this._updating)){_1d=_1c[id];}if(_1d){_17=_3.delegate(_17,_1d);}return this.inherited(arguments);},updateDirty:function(id,_1e,_1f){var _20=this.dirty,_21=_20[id];if(!_21){_21=_20[id]={};}_21[_1e]=_1f;},setDirty:function(id,_22,_23){_1.deprecated("setDirty(...)","use updateDirty() instead","dgrid 1.0");this.updateDirty(id,_22,_23);},save:function(){var _24=this,_25=this.store,_26=this.dirty,dfd=new _4(),_27=dfd.promise,_28=function(id){var _29;return (_24.getBeforePut||!(_29=_24.row(id).data))?function(){return _25.get(id);}:function(){return _29;};};function _2a(id,_2b){return function(_2c){var _2d=_24._columnsWithSet,_2e=_24._updating,key,_2f;for(key in _2b){_2c[key]=_2b[key];}if(_2d){for(key in _2d){_2f=_2d[key].set(_2c);if(_2f!==undefined){_2c[key]=_2f;}}}_2e[id]=true;return _4.when(_25.put(_2c),function(){delete _26[id];delete _2e[id];});};};for(var id in _26){var put=_2a(id,_26[id]);_27=_27.then(_28(id)).then(put);}dfd.resolve();return _27;},revert:function(){this.dirty={};this.refresh();},_trackError:function(_30){var _31;if(typeof _30=="string"){_30=_3.hitch(this,_30);}try{_31=_30();}catch(err){_6.call(this,err);}return _4.when(_31,null,_3.hitch(this,_6));}});});