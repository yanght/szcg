/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"url:esri/dijit/templates/Geocoder.html":"<div class=\"${theme}\" role=\"presentation\">\r\n    <div class=\"${_GeocoderContainerClass}\" role=\"presentation\">\r\n    \t<div class=\"${_GeocoderClass}\" data-dojo-attach-point=\"containerNode\" role=\"presentation\">\r\n    \t\t<div title=\"${_i18n.widgets.Geocoder.main.searchButtonTitle}\" tabindex=\"0\" class=\"${_searchButtonClass} ${_GeocoderIconClass}\" data-dojo-attach-point=\"submitNode\" data-dojo-attach-event=\"ondijitclick:_findThenSelect\" role=\"button\"></div>\r\n    \t\t<div aria-haspopup=\"true\" id=\"${id}_menu_button\" title=\"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}\" tabindex=\"0\" class=\"${_geocoderMenuArrowClass} ${_GeocoderIconClass}\" data-dojo-attach-point=\"geocoderMenuArrowNode\" role=\"button\" aria-expanded=\"false\" data-dojo-attach-event=\"ondijitclick:_toggleGeolocatorMenu\"></div>\r\n    \t\t<input aria-haspopup=\"true\" id=\"${id}_input\" tabindex=\"0\" placeholder=\"\" value=\"${value}\" autocomplete=\"off\" type=\"text\" data-dojo-attach-point=\"inputNode\" data-dojo-attach-event=\"ondijitclick:_inputClick\" role=\"textbox\">\r\n    \t\t<div tabindex=\"0\" class=\"${_clearButtonClass} ${_GeocoderIconClass}\" data-dojo-attach-point=\"clearNode\" data-dojo-attach-event=\"ondijitclick:clear\" role=\"button\"></div>\r\n    \t\t<div class=\"${_GeocoderClearClass}\" role=\"presentation\"></div>\r\n    \t</div>\r\n    \t<div class=\"${_resultsContainerClass}\" data-dojo-attach-point=\"resultsNode\" aria-labelledby=\"${id}_input\" role=\"menu\" aria-hidden=\"true\"></div>\r\n    \t<div class=\"${_geocoderMenuClass}\" data-dojo-attach-point=\"geocoderMenuNode\" role=\"presentation\">\r\n    \t\t<div class=\"${_geocoderMenuHeaderClass}\">\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t<div role=\"button\" data-dojo-attach-point=\"geocoderMenuCloseNode\" data-dojo-attach-event=\"ondijitclick:_hideGeolocatorMenu\" title=\"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}\" tabindex=\"0\" class=\"${_geocoderMenuCloseClass}\"></div>\r\n    \t\t\t<div class=\"${_GeocoderClearClass}\" role=\"presentation\"></div>\r\n    \t\t</div>\r\n    \t\t<div data-dojo-attach-point=\"geocoderMenuInsertNode\" aria-labelledby=\"${id}_menu_button\" role=\"menu\" aria-hidden=\"true\"></div>\r\n    \t</div>\r\n    </div>\r\n</div>"}});define("esri/dijit/Geocoder",["dojo/_base/declare","dojo/_base/Deferred","dojo/dom-construct","dojo/i18n!esri/nls/jsapi","dojo/json","dojo/keys","dojo/on","dojo/query","dojo/text!esri/dijit/templates/Geocoder.html","dojo/uacss","dijit/_OnDijitClickMixin","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/focus","esri","esri/geometry","esri/tasks/locator","esri/utils"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c,_d,_e){_1("esri.dijit.Geocoder",[_c,_a,_b],{templateString:_8,constructor:function(_f,_10){this._setPublicDefaults();_1.safeMixin(this,_f);this._setPrivateDefaults();this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoder",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);},startup:function(){if(!this._geocoders.length){console.log("No geocoders defined.");this.destroy();return;}if(!this.domNode){console.log("domNode is undefined.");this.destroy();return;}if(!this.map){console.log("Map is undefined.");this.destroy();return;}if(this.value){this._checkStatus();}this._setDelegations();},postCreate:function(){this.loaded=true;this._updateGeocoder();},destroy:function(){var i;if(this._delegations){for(i=0;i<this._delegations.length;i++){this._delegations[i].remove();}}_3.empty(this.domNode);this.inherited(arguments);},clear:function(){this.onClear();if(this.loaded){_7(this.inputNode).attr("value","");}this.value="";this.results=[];if(this.loaded){_7(this.containerNode).removeClass(this._hasValueClass);_7(this.clearNode).attr("title","");}this._hideMenus();this._hideLoading();},show:function(){if(this.loaded){_7(this.domNode).style("display","block");}},hide:function(){if(this.loaded){_7(this.domNode).style("display","none");}},find:function(){var _11=this;var _12=new _2();_11._query({delay:0}).then(function(_13){_11.onFindResults(_13);_12.resolve(_13);});return _12;},focus:function(){if(this.loaded){_d.focus(this.inputNode);}},blur:function(){if(this.loaded&&_d.curNode){_d.curNode.blur();}},select:function(e){this.onSelect(e);this._hideMenus();this._hideLoading();if(this.autoNavigate&&e&&e.hasOwnProperty("extent")){this.map.setExtent(e.extent);}},onSelect:function(e){},onFindResults:function(e){},onAutoComplete:function(e){},onGeocoderSelect:function(e){},onClear:function(){},_setPublicDefaults:function(){this.autoComplete=false;this.arcgisGeocoder=true;this.value="";this.theme="simpleGeocoder";this.activeGeocoderIndex=0;this.maxLocations=6;this.minCharacters=3;this.searchDelay=350;this.geocoderMenu=true;this.autoNavigate=true;this.showResults=true;},_setPrivateDefaults:function(){this._i18n=_4;this.results=[];this._GeocoderContainerClass="esriGeocoderContainer";this._GeocoderClass="esriGeocoder";this._GeocoderMultipleClass="esriGeocoderMultiple";this._GeocoderIconClass="esriGeocoderIcon";this._GeocoderActiveClass="esriGeocoderActive";this._loadingClass="esriGeocoderLoading";this._resultsContainerClass="esriGeocoderResults";this._resultsItemClass="esriGeocoderResult";this._resultsItemEvenClass="esriGeocoderResultEven";this._resultsItemOddClass="esriGeocoderResultOdd";this._resultsItemFirstClass="esriGeocoderResultFirst";this._resultsItemLastClass="esriGeocoderResultLast";this._resultsPartialMatchClass="esriGeocoderResultPartial";this._searchButtonClass="esriGeocoderSearch";this._clearButtonClass="esriGeocoderReset";this._hasValueClass="esriGeocoderHasValue";this._geocoderMenuClass="esriGeocoderMenu";this._geocoderMenuHeaderClass="esriGeocoderMenuHeader";this._geocoderMenuCloseClass="esriGeocoderMenuClose";this._activeMenuClass="esriGeocoderMenuActive";this._geocoderMenuArrowClass="esriGeocoderMenuArrow";this._geocoderSelectedClass="esriGeocoderSelected";this._geocoderSelectedCheckClass="esriGeocoderSelectedCheck";this._GeocoderClearClass="esriGeocoderClearFloat";},_setEsriGeocoder:function(){if(this.arcgisGeocoder){if(typeof this.arcgisGeocoder==="object"){this._arcgisGeocoder=this.arcgisGeocoder;}else{this._arcgisGeocoder={};}if(!this._arcgisGeocoder.url){this._arcgisGeocoder.url=location.protocol+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";}if(!this._arcgisGeocoder.name){this._arcgisGeocoder.name=_4.widgets.Geocoder.esriGeocoderName;}if(!this._arcgisGeocoder.hasOwnProperty("localSearchOptions")){this._arcgisGeocoder.localSearchOptions={minScale:150000,distance:12000};}this.arcgisGeocoder=this._arcgisGeocoder;}else{this.arcgisGeocoder=false;}},_setActiveGeocoder:function(){this.activeGeocoder=this._geocoders[this.activeGeocoderIndex];this._updatePlaceholder();},_setGeocoderList:function(){var _14=[];if(this.arcgisGeocoder){_14=_14.concat([this._arcgisGeocoder]);}if(this.geocoders&&this.geocoders.length){_14=_14.concat(this.geocoders);}this._geocoders=_14;},_updateGeocoder:function(){this.activeGeocoderIndex=0;this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems();},_updatePlaceholder:function(){if(this.loaded){this._placeholder="";if(this.activeGeocoder&&this.activeGeocoder.placeholder){this._placeholder=this.activeGeocoder.placeholder;}_7(this.inputNode).attr("placeholder",this._placeholder);_7(this.submitNode).attr("title",this._placeholder);}},_updateValue:function(_15,_16,_17){if(this.loaded){_7(this.inputNode).attr("value",_17);this._checkStatus();}},_updateTheme:function(_18,_19,_1a){if(this.loaded){_7(this.domNode).removeClass(_19).addClass(_1a);}},_setActiveGeocoderIndex:function(_1b,_1c,_1d){this.activeGeocoderIndex=_1d;this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();var evt={attr:this.activeGeocoder,oldVal:_1c,newVal:_1d};this.onGeocoderSelect(evt);},_query:function(e){var _1e=this;if(!e){e={delay:0};}if(this._deferred){this._deferred.cancel("stop query");}this._deferred=new _2();this._queryTimer=setTimeout(function(){_1e._performQuery();},e.delay);return this._deferred;},_performQuery:function(){if(this.value){this._hideGeolocatorMenu();this._showLoading();var _1f;var _20=this.activeGeocoder.outFields||"";var _21="";var _22=this;if(this.activeGeocoder.prefix){_21+=this.activeGeocoder.prefix;}_21+=this.value;if(this.activeGeocoder.suffix){_21+=this.activeGeocoder.suffix;}if(this.activeGeocoder===this._arcgisGeocoder){_1f={"text":_21,"outSR":this.map.spatialReference.wkid,"f":"json"};if(this.activeGeocoder.localSearchOptions&&this.activeGeocoder.localSearchOptions.hasOwnProperty("distance")&&this.activeGeocoder.localSearchOptions.hasOwnProperty("minScale")){var _23=this.map.extent.getCenter().normalize();var _24=this.map.getScale();if(!this.activeGeocoder.localSearchOptions.minScale||(_24&&_24<=parseFloat(this.activeGeocoder.localSearchOptions.minScale))){_1f.location=_5.stringify(_23.toJson());_1f.distance=this.activeGeocoder.localSearchOptions.distance;}}if(_20){_1f.outFields=_20;}if(this.maxLocations){_1f.maxLocations=this.maxLocations;}if(this.activeGeocoder.sourceCountry){_1f.sourceCountry=this.activeGeocoder.sourceCountry;}if(this.activeGeocoder.searchExtent){var _25={"xmin":this.activeGeocoder.searchExtent.xmin,"ymin":this.activeGeocoder.searchExtent.ymin,"xmax":this.activeGeocoder.searchExtent.xmax,"ymax":this.activeGeocoder.searchExtent.ymax,"spatialReference":{"wkid":this.activeGeocoder.searchExtent.spatialReference.wkid}};_1f.bbox=_5.stringify(_25);}var _26=_e.request({url:this.activeGeocoder.url+"/find",content:_1f,handleAs:"json",callbackParamName:"callback",load:function(_27){_22._receivedResults(_27.locations);}});}else{_1f={address:{"singleLine":_21}};if(_20){_1f.outFields=[_20];}if(this.activeGeocoder.searchExtent){_1f.searchExtent=this.activeGeocoder.searchExtent;}this._task=new _e.tasks.Locator(this.activeGeocoder.url);this._task.outSpatialReference=this.map.spatialReference;this._task.addressToLocations(_1f,function(_28){_22._receivedResults(_28);},function(_29){_22._receivedResults(_29);});}}else{this._hideLoading();this._deferred.resolve();}},_showResults:function(e){var _2a=this;_2a._hideGeolocatorMenu();var _2b="";if(_2a.results&&_2a.results.length&&_2a.resultsNode){var _2c=_2a.value,i;var _2d=new RegExp("("+_2c+")","gi");_2b+="<ul role=\"presentation\">";for(i=0;i<_2a.results.length;++i){var _2e=this._resultsItemClass+" ";if(i%2===0){_2e+=_2a._resultsItemOddClass;}else{_2e+=_2a._resultsItemEvenClass;}if(i===0){_2e+=" "+_2a._resultsItemFirstClass;}else{if(i===(_2a.results.length-1)){_2e+=" "+_2a._resultsItemLastClass;}}_2b+="<li data-text=\""+_2a.results[i].name+"\" data-item=\"true\" data-index=\""+i+"\" role=\"menuitem\" tabindex=\"0\" class=\""+_2e+"\">"+_2a.results[i].name.replace(_2d,"<strong class=\""+_2a._resultsPartialMatchClass+"\">"+_2c+"</strong>")+"</li>";}_2b+="</ul>";if(_2a.resultsNode){_2a.resultsNode.innerHTML=_2b;}_2a._showResultsMenu();}},_autocomplete:function(){var _2f=this;_2f._query({delay:this.searchDelay}).then(function(_30){_2f.onAutoComplete(_30);if(_2f.showResults){_2f._showResults(_30);}});},_receivedResults:function(_31){var _32=this;_32._hideLoading();var _33=_32._hydrateResults(_31);_32.results=_33;var obj={"results":_33,"value":_32.value};_32._deferred.resolve(obj);},_showLoading:function(){if(this.loaded){_7(this.containerNode).addClass(this._loadingClass);}},_hideLoading:function(){if(this.loaded){_7(this.containerNode).removeClass(this._loadingClass);}},_showGeolocatorMenu:function(){if(this.loaded){_7(this.containerNode).addClass(this._activeMenuClass);_7(this.geocoderMenuNode).style("display","block");_7(this.geocoderMenuInsertNode).attr("aria-hidden","false");_7(this.geocoderMenuArrowNode).attr("aria-expanded","true");}},_hideGeolocatorMenu:function(){if(this.loaded){var _34=_7(this.containerNode);_34.removeClass(this._activeMenuClass);_7(this.geocoderMenuNode).style("display","none");_7(this.geocoderMenuInsertNode).attr("aria-hidden","true");_7(this.geocoderMenuArrowNode).attr("aria-expanded","false");}},_toggleGeolocatorMenu:function(){this._hideResultsMenu();if(this.loaded){var _35=_7(this.geocoderMenuNode).style("display");if(_35[0]==="block"){this._hideGeolocatorMenu();}else{this._showGeolocatorMenu();}}},_showResultsMenu:function(){if(this.loaded){_7(this.containerNode).addClass(this._GeocoderActiveClass);_7(this.resultsNode).style("display","block");_7(this.resultsNode).attr("aria-hidden","false");}},_hideResultsMenu:function(){if(this.loaded){_7(this.resultsNode).style("display","none");_7(this.containerNode).removeClass(this._GeocoderActiveClass);_7(this.resultsNode).attr("aria-hidden","true");}},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu();},_insertGeocoderMenuItems:function(){if(this.loaded){if(this.geocoderMenu&&this._geocoders.length>1){var _36="";var _37="",i;_36+="<ul role=\"presentation\">";for(i=0;i<this._geocoders.length;i++){_37=this._resultsItemClass+" ";if(i%2===0){_37+=this._resultsItemOddClass;}else{_37+=this._resultsItemEvenClass;}if(i===this.activeGeocoderIndex){_37+=" "+this._geocoderSelectedClass;}if(i===0){_37+=" "+this._resultsItemFirstClass;}else{if(i===(this._geocoders.length-1)){_37+=" "+this._resultsItemLastClass;}}var _38=this._geocoders[i].name||_4.widgets.Geocoder.main.untitledGeocoder;_36+="<li data-index=\""+i+"\" data-item=\"true\" role=\"menuitem\" tabindex=\"0\" class=\""+_37+"\">";_36+="<div class=\""+this._geocoderSelectedCheckClass+"\"></div>";_36+=_38;_36+="<div class=\""+this._GeocoderClearClass+"\"></div>";_36+="</li>";}_36+="</ul>";this.geocoderMenuInsertNode.innerHTML=_36;_7(this.geocoderMenuNode).style("display","none");_7(this.geocoderMenuArrowNode).style("display","block");_7(this.containerNode).addClass(this._GeocoderMultipleClass);}else{this.geocoderMenuInsertNode.innerHTML="";_7(this.geocoderMenuNode).style("display","none");_7(this.geocoderMenuArrowNode).style("display","none");_7(this.containerNode).removeClass(this._GeocoderMultipleClass);}}},_checkStatus:function(){if(this.loaded){if(this.value){_7(this.containerNode).addClass(this._hasValueClass);_7(this.clearNode).attr("title",_4.widgets.Geocoder.main.clearButtonTitle);}else{this.clear();}}},_setDelegations:function(){var _39=this;this._delegations=[];var _3a=on(document,"click",function(_3b){_39._hideResultsMenu(_3b);});this._delegations.push(_3a);var _3c=on(this.inputNode,"keyup",function(_3d){_39._inputKeyUp(_3d);});this._delegations.push(_3c);var _3e=on(this.inputNode,"keydown",function(_3f){_39._inputKeyDown(_3f);});this._delegations.push(_3e);var _40=on(this.geocoderMenuArrowNode,"keydown",_39._geocoderMenuButtonKeyDown());this._delegations.push(_40);var _41=on(this.resultsNode,"[data-item=\"true\"]:click, [data-item=\"true\"]:keydown",function(_42){clearTimeout(_39._queryTimer);var _43=_7("[data-item=\"true\"]",_39.resultsNode);var _44=parseInt(_7(this).attr("data-index")[0],10);var _45=_7(this).attr("data-text");var _46;if(_42.type==="click"||(_42.type==="keydown"&&_42.keyCode===_6.ENTER)){_7(_39.inputNode).attr("value",_45);_39.value=_45;if(_39.results&&_39.results[_44]){_39.select(_39.results[_44]);}}else{if(_42.type==="keydown"&&_42.keyCode===_6.UP_ARROW){_46=_44-1;if(_46<0){_39.inputNode.focus();}else{_43[_46].focus();}}else{if(_42.type==="keydown"&&_42.keyCode===_6.DOWN_ARROW){_46=_44+1;if(_46>=_43.length){_39.inputNode.focus();}else{_43[_46].focus();}}else{if(_42.keyCode===_6.ESCAPE){clearTimeout(_39._queryTimer);_39._hideMenus();}}}}});this._delegations.push(_41);var _47=on(this.geocoderMenuInsertNode,"[data-item=\"true\"]:click, [data-item=\"true\"]:keydown",function(_48){var _49=_7("[data-item=\"true\"]",_39.geocoderMenuInsertNode);var _4a=parseInt(_7(this).attr("data-index")[0],10);var _4b;if(_48.type==="click"||(_48.type==="keydown"&&_48.keyCode===_6.ENTER)){_39._setActiveGeocoderIndex(null,null,_4a);_39._hideGeolocatorMenu();}else{if(_48.type==="keydown"&&_48.keyCode===_6.UP_ARROW){_4b=_4a-1;if(_4b<0){_39.geocoderMenuArrowNode.focus();}else{_49[_4b].focus();}}else{if(_48.type==="keydown"&&_48.keyCode===_6.DOWN_ARROW){_4b=_4a+1;if(_4b>=_49.length){_39.geocoderMenuArrowNode.focus();}else{_49[_4b].focus();}}else{if(_48.keyCode===_6.ESCAPE){_39._hideGeolocatorMenu();}}}}});this._delegations.push(_47);},_findThenSelect:function(){var _4c=this;this.find().then(function(_4d){if(_4d.results&&_4d.results.length){_4c.select(_4d.results[0]);}});},_inputKeyUp:function(_4e){if(_4e){var _4f=this;clearTimeout(this._queryTimer);var _50=this.inputNode.value;this.value=_50;var _51=0;if(_50){_51=_50.length;}var _52=_7("[data-item=\"true\"]",this.resultsNode);if(_4e.keyCode===_4e.shiftKey||_4e.keyCode===_6.UP_ARROW||_4e.keyCode===_6.DOWN_ARROW||_4e.keyCode===_6.LEFT_ARROW||_4e.keyCode===_6.RIGHT_ARROW){return;}else{if(_4e&&_4e.keyCode===_6.ENTER){this._findThenSelect();}else{if(_4e&&_4e.keyCode===_6.ESCAPE){clearTimeout(this._queryTimer);this._hideMenus();}else{if(this.autoComplete&&_51>=this.minCharacters){this._autocomplete();}else{this._hideMenus();}}}}this._checkStatus();}},_inputKeyDown:function(_53){var _54=_7("[data-item=\"true\"]",this.resultsNode);if(_53&&_53.keyCode===_6.TAB){this._hideMenus();if(this._deferred){this._deferred.cancel("stop query");}return;}else{if(_53&&_53.keyCode===_6.UP_ARROW){var _55=_54.length;if(_55){_54[_55-1].focus();}}else{if(_53&&_53.keyCode===_6.DOWN_ARROW){if(_54[0]){_54[0].focus();}}}}},_geocoderMenuButtonKeyDown:function(_56){var _57=_7("[data-item=\"true\"]",this.geocoderMenuInsertNode);if(_56&&_56.keyCode===_6.UP_ARROW){this._showGeolocatorMenu();var _58=_57.length;if(_58){_57[_58-1].focus();}}else{if(_56&&_56.keyCode===_6.DOWN_ARROW){this._showGeolocatorMenu();if(_57[0]){_57[0].focus();}}}},_inputClick:function(){this._hideGeolocatorMenu();if(!this.value){this.clear();this._hideMenus();}this._checkStatus();},_hydrateResults:function(e){var _59=this;var _5a=[];if(e&&e.length){var i=0;for(i;i<e.length&&i<_59.maxLocations;i++){var _5b={},_5c;if(e[i].hasOwnProperty("extent")){_5b.extent=new _e.geometry.Extent(e[i].extent);_5b.extent.setSpatialReference(new _e.SpatialReference(_59.map.spatialReference));if(e[i].hasOwnProperty("name")){_5b.name=e[i].name;}if(e[i].hasOwnProperty("feature")){_5b.feature=new _e.Graphic(e[i].feature);_5c=_5b.feature.geometry;if(_5c){_5c.setSpatialReference(_59.map.spatialReference);}}}else{if(e[i].hasOwnProperty("location")){var _5d=new _e.geometry.Point(e[i].location.x,e[i].location.y,_59.map.spatialReference);_5b.extent=_59.map.extent.centerAt(_5d);if(e[i].hasOwnProperty("address")){_5b.name=e[i].address;}var _5e={};if(e[i].hasOwnProperty("attributes")){_5e=e[i].attributes;}if(e[i].hasOwnProperty("score")){_5e.score=e[i].score;}_5b.feature=new _e.Graphic(_5d,null,_5e,null);}}_5a.push(_5b);}}return _5a;}});});