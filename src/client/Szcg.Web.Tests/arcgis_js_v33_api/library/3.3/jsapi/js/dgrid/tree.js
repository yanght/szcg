//>>built
define("dgrid/tree",["dojo/_base/declare","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","dojo/has!touch?./util/touch","put-selector/put"],function(_1,_2,_3,on,_4,_5,_6){dojo.getObject("dgrid.tree",true);return (dgrid.tree=function(_7){var _8=_7.renderCell||function(_9,_a,td){if(_a!=null){_6(td,"span.dgrid-expando-text",_a);}};_7.renderCell=function(_b,_c,td,_d){var _e=Number(_d.query.level)+1;_e=isNaN(_e)?0:_e;var _f=this.grid;var _10;var _11=!_f.store.mayHaveChildren||_f.store.mayHaveChildren(_b);var dir=_f.isRTL?"right":"left";var _12=_6(td,"div.dgrid-expando-icon"+(_11?".ui-icon.ui-icon-triangle-1-e":"")+"[style=margin-"+dir+": "+(_e*19)+"px; float: "+dir+"]");_12.innerHTML="&nbsp;";_8.call(this,_b,_c,td,_d);_12.level=_e;_12.mayHaveChildren=_11;var tr,_13;if(!_f.expand){var _14=".dgrid-content .dgrid-column-"+_7.id;_f.on(_7.expandOn||".dgrid-expando-icon:click,"+_14+":dblclick,"+_14+":keydown",function(_15){if(_15.type!="keydown"||_15.keyCode==32){_f.expand(this);}});if(_5){_f.on(_5.selector(_14,_5.dbltap),function(){_f.expand(this);});}_4.before(_f,"removeRow",function(_16,_17){var _18=_16.connected;if(_18){_3(">.dgrid-row",_18).forEach(function(_19){_f.removeRow(_19);});if(!_17){_6(_18,"!");}}});_f._calcRowHeight=function(_1a){var _1b=_1a.connected;return _1a.offsetHeight+(_1b?_1b.offsetHeight:0);};_f.expand=function(_1c,_1d){_1c=_1c.element||_1c;_1c=_1c.className.indexOf("dgrid-expando-icon")>-1?_1c:_3(".dgrid-expando-icon",_1c)[0];if(_1c.mayHaveChildren){var _1e=_1c.expanded=_1d===undefined?!_1c.expanded:_1d;_1c.className="dgrid-expando-icon ui-icon ui-icon-triangle-1-"+(_1e?"se":"e");var _1f=_1c.preloadNode,row=_f.row(_1c),_20=row.element,_21;if(!_1f){_21=_20.connected=_6("div.dgrid-tree-container");_1f=_1c.preloadNode=_6(_20,"+",_21,"div.dgrid-preload");var _22=function(_23){return _f.store.getChildren(row.data,_23);};_22.level=_1c.level;_2.when(_f.renderQuery?_f._trackError(function(){return _f.renderQuery(_22,_1f);}):_f.renderArray(_22({}),_1f),function(){_21.style.height=_21.scrollHeight+"px";});var _24=function(_25){var _26=this.style.height;if(_26){this.style.display=_26=="0px"?"none":"block";}if(_25){_6(this,".dgrid-tree-resetting");setTimeout(function(){_6(_21,"!dgrid-tree-resetting");});_10=true;}else{if(!_10){_10=false;}}this.style.height="";};on(_21,"transitionend,webkitTransitionEnd,oTransitionEnd,MSTransitionEnd",_24);if(!_10){setTimeout(function(){_24.call(_21);},600);}}_21=_20.connected;var _27=_21.style;_21.hidden=!_1e;if(_10===false){_27.display=_1e?"block":"none";_27.height="";}else{if(_1e){_27.display="block";var _28=_21.scrollHeight;_27.height="0px";}else{_6(_21,".dgrid-tree-resetting");_27.height=_21.scrollHeight+"px";}if(!_1e||_28){setTimeout(function(){_6(_21,"!dgrid-tree-resetting");_27.height=(_1e?_28:0)+"px";});}}}};}};return _7;});});