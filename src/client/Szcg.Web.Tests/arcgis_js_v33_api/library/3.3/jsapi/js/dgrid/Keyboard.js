//>>built
define("dgrid/Keyboard",["dojo/_base/declare","dojo/aspect","dojo/on","./List","dojo/_base/lang","dojo/has","put-selector/put","dojo/_base/Deferred","dojo/_base/sniff"],function(_1,_2,on,_3,_4,_5,_6,_7){var _8={checkbox:1,radio:1,button:1},_9=/\bdgrid-cell\b/,_a=/\bdgrid-row\b/;_5.add("dom-contains",function(){return !!document.createElement("a").contains;});function _b(_c,_d){if(_5("dom-contains")){return _c.contains(_d);}else{return _c.compareDocumentPosition(_d)&8;}};return _1("dgrid.Keyboard",[_3],{pageSkip:10,tabIndex:0,postCreate:function(){this.inherited(arguments);var _e=this;function _f(_10){var _11=_10.target;return _11.type&&(!_8[_11.type]||_10.keyCode==32);};function _12(_13){function _14(_15,_16,_17){var _18=_e[_e.cellNavigation?"cell":"row"](_15);if(_18){_15=_18.element;if(_15){if(!_16.bubbles){_16.bubbles=true;}_6(_19,"!dgrid-focus[!tabIndex]");if(_19){if(_5("ie")<8){_19.style.position="";}_16.cell=_19;on.emit(_15,"dgrid-cellfocusout",_16);}_19=_15;_16.cell=_15;if(!_17){if(_5("ie")<8){_15.style.position="relative";}_15.tabIndex=_e.tabIndex;_15.focus();}_6(_15,".dgrid-focus");on.emit(_19,"dgrid-cellfocusin",_4.mixin({parentType:_16.type},_16));}}};var _1a=_e.cellNavigation?_9:_a,_19=_13,_1b;while((_1b=_19.firstChild)&&_1b.tagName){_19=_1b;}if(_13===_e.contentNode){_2.after(_e,"renderArray",function(ret){return _7.when(ret,function(ret){if(_1a.test(_19.className)&&_b(_13,_19)){return ret;}for(var i=0,_1c=_13.getElementsByTagName("*"),_1d;(_1d=_1c[i]);++i){if(_1a.test(_1d.className)){_19=_1d;break;}}_19.tabIndex=_e.tabIndex;return ret;});});}else{if(_1a.test(_19.className)){_19.tabIndex=_e.tabIndex;}}on(_13,"mousedown",function(_1e){if(!_f(_1e)){_14(_1e.target,_1e);}});on(_13,"keydown",function(_1f){if(_1f.metaKey||_1f.altKey){return;}var _20=_1f.target;var _21=_1f.keyCode;if(_f(_1f)){return;}var _22={32:0,33:-_e.pageSkip,34:_e.pageSkip,37:-1,38:-1,39:1,40:1,35:10000,36:-10000}[_21];if(isNaN(_22)){return;}var _23,_24,_25=_e.cell(_19);var _26;if(_21==37||_21==39){if(!_e.cellNavigation){return;}_26="right";}else{_26="down";_24=_25&&_25.column&&_25.column.id;_25=_e.row(_19);}if(_22){_25=_25&&_e[_26](_25,_22,true);}var _27=_25&&_25.element;if(_27){if(_24){_27=_e.cell(_27,_24).element;}if(_e.cellNavigation){var _28=_27.getElementsByTagName("input");var _29;for(var i=0;i<_28.length;i++){var _2a=_28[i];if((_2a.tabIndex!=-1||"lastValue" in _2a)&&!_2a.disabled){if(_5("ie")<8){_2a.style.position="relative";}_2a.focus();if(_5("ie")<8){_2a.style.position="";}_29=true;break;}}}_14(_27,_1f,_29);}_1f.preventDefault();});};if(_e.tabableHeader){_12(_e.headerNode);}_12(_e.contentNode);}});});