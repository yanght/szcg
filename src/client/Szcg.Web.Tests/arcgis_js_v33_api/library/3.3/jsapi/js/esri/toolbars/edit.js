/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define("esri/toolbars/edit",["dijit","dojo","dojox","dojo/require!esri/toolbars/_toolbar,esri/toolbars/_GraphicMover,esri/toolbars/_VertexEditor,esri/toolbars/_Box"],function(_1,_2,_3){_2.provide("esri.toolbars.edit");_2.require("esri.toolbars._toolbar");_2.require("esri.toolbars._GraphicMover");_2.require("esri.toolbars._VertexEditor");_2.require("esri.toolbars._Box");_2.declare("esri.toolbars.Edit",esri.toolbars._Toolbar,{constructor:function(_4,_5){this._map=_4;this._tool=0;this._scratchGL=_4.graphics;var _6=esri.isTouchEnabled;this._defaultOptions=_2.mixin({vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,_6?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([0,0,0,0.5]),1),new _2.Color([128,128,128])),ghostVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,_6?18:10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([0,0,0,0.5]),1),new _2.Color([255,255,255,0.75])),ghostLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DOT,new _2.Color([128,128,128]),2),allowDeleteVertices:true,allowAddVertices:true,rotateHandleOffset:_6?24:16,boxLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new _2.Color([64,64,64]),1),boxHandleSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,_6?16:9,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([0,0,0,0.5]),1),new _2.Color([255,255,255,0.75]))},_5||{});},activate:function(_7,_8,_9){this.deactivate();this._graphic=_8;this._options=_2.mixin(_2.mixin({},this._defaultOptions),_9||{});var _a=esri.toolbars.Edit.MOVE,_b=esri.toolbars.Edit.EDIT_VERTICES,_c=esri.toolbars.Edit.SCALE,_d=esri.toolbars.Edit.ROTATE,_e=false,_f=false,box=false,map=this._map,_10=map.spatialReference,_11=_8.geometry.spatialReference;this._geo=!!(_10&&_11&&!_10.equals(_11)&&_10.isWebMercator()&&_11.wkid===4326);if((_7&_a)===_a){_e=this._enableMove(_8);}var _12=((_7&_c)===_c),_13=((_7&_d)===_d);if(_12||_13){box=this._enableBoxEditing(_8,_12,_13);}if((_7&_b)===_b){_f=this._enableVertexEditing(_8);}if(!(_e||_f||box)){throw new Error("[esri.toolbars.Edit::activate] "+esri.bundle.toolbars.edit.invalidType);}this._tool=_7;if(this._tool){this._mapPanEndHandle=_2.connect(map,"onPanEnd",this,this._mapPanEndHandler);this._mapExtChgHandle=_2.connect(map,"onExtentChange",this,this._mapExtentChangeHandler);this.onActivate(this._tool,_8);}if(map.snappingManager&&(_e||_f)){map.snappingManager._startSelectionLayerQuery();}},deactivate:function(){var _14=this._tool,_15=this._graphic;if(!_14){return;}var _16=!!this._modified;this._clear();_2.disconnect(this._mapPanEndHandle);_2.disconnect(this._mapExtChgHandle);this._mapPanEndHandle=this._mapExtChgHandle=null;this._graphic=this._geo=null;this.onDeactivate(_14,_15,{isModified:_16});if(this._map.snappingManager){this._map.snappingManager._stopSelectionLayerQuery();}},refresh:function(){this._refreshMoveables(true);},getCurrentState:function(){return {tool:this._tool,graphic:this._graphic,isModified:!!this._modified};},onActivate:function(_17,_18){},onDeactivate:function(_19,_1a,_1b){},onGraphicMoveStart:function(_1c){},onGraphicFirstMove:function(_1d){this._modified=true;},onGraphicMove:function(_1e,_1f){},onGraphicMoveStop:function(_20,_21){},onGraphicClick:function(_22,_23){},onVertexMoveStart:function(_24,_25){},onVertexFirstMove:function(_26,_27){this._modified=true;},onVertexMove:function(_28,_29,_2a){},onVertexMoveStop:function(_2b,_2c,_2d){},onVertexAdd:function(_2e,_2f){this._modified=true;},onVertexClick:function(_30,_31){},onVertexMouseOver:function(_32,_33){},onVertexMouseOut:function(_34,_35){},onVertexDelete:function(_36,_37){this._modified=true;},onScaleStart:function(_38){},onScaleFirstMove:function(_39){this._modified=true;},onScale:function(_3a,_3b){},onScaleStop:function(_3c,_3d){},onRotateStart:function(_3e){},onRotateFirstMove:function(_3f){this._modified=true;},onRotate:function(_40,_41){},onRotateStop:function(_42,_43){},_enableMove:function(_44){var map=this._map,_45=_44.geometry.type;switch(_45){case "point":case "polyline":case "polygon":this._graphicMover=new esri.toolbars._GraphicMover(_44,map,this);return true;case "multipoint":break;}return false;},_enableVertexEditing:function(_46){var map=this._map,_47=_46.geometry.type;switch(_47){case "point":break;case "multipoint":case "polyline":case "polygon":this._vertexEditor=esri.toolbars._GraphicVertexEditor.create(_46,map,this);return true;}return false;},_enableBoxEditing:function(_48,_49,_4a){var map=this._map,_4b=_48.geometry.type;switch(_4b){case "point":case "multipoint":break;case "polyline":case "polygon":this._boxEditor=new esri.toolbars._Box(_48,map,this,_49,_4a,this._options.uniformScaling);return true;}return false;},_disableMove:function(){var _4c=this._graphicMover;if(_4c){_4c.destroy();this._graphicMover=null;}},_disableVertexEditing:function(){var _4d=this._vertexEditor;if(_4d){_4d.destroy();this._vertexEditor=null;}},_disableBoxEditing:function(){var box=this._boxEditor;if(box){box.destroy();this._boxEditor=null;}},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._tool=0;this._modified=false;},_mapPanEndHandler:function(){this._refreshMoveables();},_mapExtentChangeHandler:function(e,d,_4e){if(_4e){this._refreshMoveables();}},_refreshMoveables:function(_4f){var _50=_2.filter([this._graphicMover,this._vertexEditor,this._boxEditor],esri._isDefined);_2.forEach(_50,function(mov){mov.refresh(_4f);});},_beginOperation:function(_51){_2.forEach(this._getAffectedTools(_51),function(_52){_52.suspend();});},_endOperation:function(_53){_2.forEach(this._getAffectedTools(_53),function(_54){_54.resume();});},_getAffectedTools:function(_55){var _56=[];switch(_55){case "MOVE":_56=[this._vertexEditor,this._boxEditor];break;case "VERTICES":_56=[this._boxEditor];break;case "BOX":_56=[this._vertexEditor];break;}_56=_2.filter(_56,esri._isDefined);return _56;}});_2.mixin(esri.toolbars.Edit,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8});});