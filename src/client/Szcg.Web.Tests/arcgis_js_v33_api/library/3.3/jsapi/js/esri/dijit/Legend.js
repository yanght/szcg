/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define("esri/dijit/Legend",["dijit","dojo","dojox","dojo/require!dijit/_Widget,dojo/DeferredList,dojox/html/entities"],function(_1,_2,_3){_2.provide("esri.dijit.Legend");_2.require("dijit._Widget");_2.require("dojo.DeferredList");_2.require("dojox.html.entities");_2.declare("esri.dijit.Legend",[_1._Widget],{widgetsInTemplate:false,layers:null,alignRight:false,_ieTimer:100,constructor:function(_4,_5){_2.mixin(this,esri.bundle.widgets.legend);_4=_4||{};if(!_4.map){console.error("esri.dijit.Legend: unable to find the 'map' property in parameters");return;}if(!_5){console.error("esri.dijit.Legend: must specify a container for the legend");return;}this.map=_4.map;this.layerInfos=_4.layerInfos;this._respectCurrentMapScale=(_4.respectCurrentMapScale===false)?false:true;this.arrangement=(_4.arrangement===esri.dijit.Legend.ALIGN_RIGHT)?esri.dijit.Legend.ALIGN_RIGHT:esri.dijit.Legend.ALIGN_LEFT;if(this.arrangement===esri.dijit.Legend.ALIGN_RIGHT){this.alignRight=true;}this.autoUpdate=(_4.autoUpdate===false)?false:true;this._surfaceItems=[];},startup:function(){this.inherited(arguments);this._initialize();if(_2.isIE){this._repaintItems=_2.hitch(this,this._repaintItems);setTimeout(this._repaintItems,this._ieTimer);}},destroy:function(){this._deactivate();this.inherited(arguments);},refresh:function(_6){if(!this.domNode){return;}if(_6){this.layerInfos=_6;this.layers=[];_2.forEach(this.layerInfos,function(_7){if(this._isSupportedLayerType(_7.layer)){if(_7.title){_7.layer._titleForLegend=_7.title;}if(_7.defaultSymbol===false){_7.layer._hideDefaultSymbolInLegend=true;}if(_7.hideLayers){_7.layer._hideLayersInLegend=_7.hideLayers;this._addSubLayersToHide(_7);}else{_7.layer._hideLayersInLegend=[];}this.layers.push(_7.layer);}},this);}else{if(this.useAllMapLayers){this.layerInfos=null;this.layers=null;}}for(var i=this.domNode.children.length-1;i>=0;i--){_2.destroy(this.domNode.children[i]);}this.startup();},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){if(this.layerInfos){this.layers=[];_2.forEach(this.layerInfos,function(_8){if(this._isSupportedLayerType(_8.layer)){if(_8.title){_8.layer._titleForLegend=_8.title;}if(_8.defaultSymbol===false){_8.layer._hideDefaultSymbol=true;}if(_8.hideLayers){_8.layer._hideLayersInLegend=_8.hideLayers;this._addSubLayersToHide(_8);}else{_8.layer._hideLayersInLegend=[];}this.layers.push(_8.layer);}},this);}this.useAllMapLayers=false;if(!this.layers){this.useAllMapLayers=true;this.layers=[];var _9=[];_2.forEach(this.map.layerIds,function(_a){var _b=this.map.getLayer(_a);if(this._isSupportedLayerType(_b)){if(_b.arcgisProps&&_b.arcgisProps.title){_b._titleForLegend=_b.arcgisProps.title;}this.layers.push(_b);}if(_b.declaredClass=="esri.layers.KMLLayer"){_2.forEach(_b.getLayers(),function(_c){_9.push(_c.id);},this);}},this);_2.forEach(this.map.graphicsLayerIds,function(_d){var _e=this.map.getLayer(_d);if(_2.indexOf(_9,_d)==-1){if(this._isSupportedLayerType(_e)&&_e._params&&_e._params.drawMode){if(_e.arcgisProps&&_e.arcgisProps.title){_e._titleForLegend=_e.arcgisProps.title;}this.layers.push(_e);}}},this);}this._createLegend();},_activate:function(){this._deactivate();if(!this.autoUpdate){return;}if(this._respectCurrentMapScale){this._ozeConnect=_2.connect(this.map,"onZoomEnd",this,"_refreshLayers");}if(this.useAllMapLayers){this._olaConnect=_2.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers");this._olrConnect=_2.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers");this._olroConnect=_2.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers");}_2.forEach(this.layers,function(_f){_f.ovcConnect=_2.connect(_f,"onVisibilityChange",this,"_refreshLayers");_f.oscConnect=_2.connect(_f,"onScaleRangeChange",this,"_refreshLayers");if(_f.declaredClass==="esri.layers.ArcGISDynamicMapServiceLayer"&&_f.supportsDynamicLayers){_f.odcConnect=_2.connect(_f,"_onDynamicLayersChange",this,"_updateDynamicLayers");}},this);},_deactivate:function(){if(this._ozeConnect){_2.disconnect(this._ozeConnect);}if(this._olaConnect){_2.disconnect(this._olaConnect);}if(this._olroConnect){_2.disconnect(this._olroConnect);}if(this._olrConnect){_2.disconnect(this._olrConnect);}_2.forEach(this.layers,function(_10){if(_10.ovcConnect){_2.disconnect(_10.ovcConnect);}if(_10.oscConnect){_2.disconnect(_10.oscConnect);}if(_10.odcConnect){_2.disconnect(_10.odcConnect);}},this);},_updateDynamicLayers:function(){this._dynamicLayerChanged=true;this._refreshLayers();},_refreshLayers:function(){this.refresh();},_updateAllMapLayers:function(){this.layers=[];_2.forEach(this.map.layerIds,function(_11){var _12=this.map.getLayer(_11);if(this._isSupportedLayerType(_12)){this.layers.push(_12);}},this);_2.forEach(this.map.graphicsLayerIds,function(_13){var _14=this.map.getLayer(_13);if(this._isSupportedLayerType(_14)&&_14._params&&_14._params.drawMode){this.layers.push(_14);}},this);this.refresh();},_createLegend:function(){_2.style(this.domNode,"position","relative");_2.create("div",{id:this.id+"_msg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var _15=[];_2.forEach(this.layers,function(_16){if(_16.declaredClass=="esri.layers.KMLLayer"){_2.forEach(_16.getLayers(),function(_17){if(_17.declaredClass=="esri.layers.FeatureLayer"&&_16._titleForLegend){_17._titleForLegend=_16._titleForLegend+" - ";if(_17.geometryType=="esriGeometryPoint"){_17._titleForLegend+="Points";}else{if(_17.geometryType=="esriGeometryPolyline"){_17._titleForLegend+="Lines";}else{if(_17.geometryType=="esriGeometryPolygon"){_17._titleForLegend+="Polygons";}}}_15.push(_17);}});}else{_15.push(_16);}},this);var _18=[];_2.forEach(_15,function(_19){if(_19.visible===true&&(_19.layerInfos||_19.renderer)){var d=_2.create("div",{id:this.id+"_"+_19.id,style:"display: none;","class":"esriLegendService"});_2.create("span",{innerHTML:this._getServiceTitle(_19),"class":"esriLegendServiceLabel"},_2.create("td",{align:(this.alignRight?"right":"")},_2.create("tr",{},_2.create("tbody",{},_2.create("table",{width:"95%"},d)))));_2.place(d,this.id,"first");if(_2.isIE){_2.style(_2.byId(this.id+"_"+_19.id),"display","none");}if((_19.legendResponse||_19.renderer)&&!this._dynamicLayerChanged){this._createLegendForLayer(_19);}else{_18.push(this._legendRequest(_19));}this._dynamicLayerChanged=false;}},this);if(_18.length===0){_2.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate();}else{var _1a=new _2.DeferredList(_18);_1a.addCallback(_2.hitch(this,function(_1b){_2.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate();}));}},_createLegendForLayer:function(_1c){if(_1c.legendResponse||_1c.renderer){var _1d=false;if(_1c.legendResponse){var _1e=_1c.dynamicLayerInfos||_1c.layerInfos;_2.forEach(_1e,function(_1f,i){if(!_1c._hideLayersInLegend||_2.indexOf(_1c._hideLayersInLegend,_1f.id)==-1){var f=this._buildLegendItems(_1c,_1f,i);_1d=_1d||f;}},this);}else{if(_1c.renderer){var id;if(!_1c.url){id="fc_"+_1c.id;}else{id=_1c.url.substring(_1c.url.lastIndexOf("/")+1,_1c.url.length);}var _20={id:id,name:null,subLayerIds:null,parentLayerId:-1};_1d=this._buildLegendItems(_1c,_20,0);}}if(_1d){_2.style(_2.byId(this.id+"_"+_1c.id),"display","block");_2.style(_2.byId(this.id+"_msg"),"display","none");}}},_legendRequest:function(_21){if(!_21.loaded){_2.connect(_21,"onLoad",_2.hitch(this,"_legendRequest"));return;}if(_21.version>=10.01){return this._legendRequestServer(_21);}else{return this._legendRequestTools(_21);}},_legendRequestServer:function(_22){var url=_22.url;var pos=url.indexOf("?");if(pos>-1){url=url.substring(0,pos)+"/legend"+url.substring(pos);}else{url+="/legend";}var _23=_22._getToken();if(_23){url+="?token="+_23;}var _24=_2.hitch(this,"_processLegendResponse");var _25={};_25.f="json";if(_22._params.dynamicLayers){_25.dynamicLayers=_22._params.dynamicLayers;if(_25.dynamicLayers==="[{}]"){_25.dynamicLayers="[]";}}var _26=esri.request({url:url,content:_25,callbackParamName:"callback",load:function(_27,_28){_24(_22,_27,_28);},error:esriConfig.defaults.io.errorHandler});return _26;},_legendRequestTools:function(_29){var p=_29.url.toLowerCase().indexOf("/rest/");var _2a=_29.url.substring(0,p)+_29.url.substring(p+5,_29.url.length);var url=this._legendUrl+"?soapUrl="+escape(_2a);if(!_2.isIE||_2.isIE>8){url+="&returnbytes=true";}var _2b=_2.hitch(this,"_processLegendResponse");var _2c={};_2c.f="json";var _2d=esri.request({url:url,content:_2c,callbackParamName:"callback",load:function(_2e,_2f){_2b(_29,_2e,_2f);},error:esriConfig.defaults.io.errorHandler});return _2d;},_processLegendResponse:function(_30,_31){if(_31&&_31.layers){_30.legendResponse=_31;_2.empty(_2.byId(this.id+"_"+_30.id));this._createLegendForLayer(_30);}else{console.log("Legend could not get generated for "+_30.url+": "+_2.toJson(_31));}},_buildLegendItems:function(_32,_33,pos){var _34=false;var _35=_2.byId(this.id+"_"+_32.id);var _36=_33.subLayerIds;var _37=_33.parentLayerId;if(_36){var _38=_2.create("div",{id:this.id+"_"+_32.id+"_"+_33.id+"_group",style:"display: none;","class":(_37==-1)?((pos>0)?"esriLegendGroupLayer":""):(this.alignRight?"esriLegendRight":"esriLegendLeft")},(_37==-1)?_35:_2.byId(this.id+"_"+_32.id+"_"+_37+"_group"));if(_2.isIE){_2.style(_2.byId(this.id+"_"+_32.id+"_"+_33.id+"_group"),"display","none");}_2.create("td",{innerHTML:_33.name.replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;"),align:(this.alignRight?"right":"")},_2.create("tr",{},_2.create("tbody",{},_2.create("table",{width:"95%","class":"esriLegendLayerLabel"},_38))));}else{if(_32.visibleLayers&&(","+_32.visibleLayers+",").indexOf(","+_33.id+",")==-1){return _34;}var d=_2.create("div",{id:this.id+"_"+_32.id+"_"+_33.id,style:"display:none;","class":(_37>-1)?(this.alignRight?"esriLegendRight":"esriLegendLeft"):""},(_37==-1)?_35:_2.byId(this.id+"_"+_32.id+"_"+_37+"_group"));if(_2.isIE){_2.style(_2.byId(this.id+"_"+_32.id+"_"+_33.id),"display","none");}_2.create("td",{innerHTML:(_33.name)?_33.name.replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;"):"",align:(this.alignRight?"right":"")},_2.create("tr",{},_2.create("tbody",{},_2.create("table",{width:"95%","class":"esriLegendLayerLabel"},d))));if(_32.legendResponse){_34=_34||this._buildLegendItems_Tools(_32,_33,d);}else{if(_32.renderer){_34=_34||this._buildLegendItems_Renderer(_32,_33,d);}}}return _34;},_buildLegendItems_Tools:function(_39,_3a,_3b){var _3c=_3a.parentLayerId;var _3d=esri.geometry.getScale(this.map);var _3e=false;if(!this._respectCurrentMapScale||(this._respectCurrentMapScale&&this._isLayerInScale(_39,_3a,_3d))){for(var i=0;i<_39.legendResponse.layers.length;i++){if(_3a.id==_39.legendResponse.layers[i].layerId){var _3f=_39.legendResponse.layers[i].legend;if(_3f.length==3&&_3f[0].label.replace(/\s+/g,"").indexOf(":Band_")>-1){}else{var _40=_2.create("tbody",{},_2.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},_3b));_2.forEach(_3f,function(_41){if((_41.url&&_41.url.indexOf("http")===0)||(_41.imageData&&_41.imageData.length>0)){_3e=true;this._buildRow_Tools(_41,_40,_39,_3a.id);}},this);}break;}}}if(_3e){_2.style(_2.byId(this.id+"_"+_39.id+"_"+_3a.id),"display","block");if(_3c>-1){_2.style(_2.byId(this.id+"_"+_39.id+"_"+_3c+"_group"),"display","block");this._findParentGroup(_39.id,_39,_3c);}}return _3e;},_buildRow_Tools:function(_42,_43,_44,_45){var tr=_2.create("tr",{},_43);var _46;var _47;if(this.alignRight){_46=_2.create("td",{align:"right"},tr);_47=_2.create("td",{align:"right",width:35},tr);}else{_47=_2.create("td",{width:35},tr);_46=_2.create("td",{},tr);}var src=_42.url;if((!_2.isIE||_2.isIE>8)&&_42.imageData&&_42.imageData.length>0){src="data:image/png;base64,"+_42.imageData;}else{if(_42.url.indexOf("http")!==0){src=_44.url+"/"+_45+"/images/"+_42.url;var _48=_44._getToken();if(_48){src+="?token="+_48;}}}var img=_2.create("img",{src:src,border:0,style:"opacity:"+_44.opacity},_47);_2.create("td",{innerHTML:_42.label.replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;"),align:(this.alignRight?"right":"")},_2.create("tr",{},_2.create("tbody",{},_2.create("table",{width:"95%",dir:"ltr"},_46))));if(_2.isIE<9){img.style.filter="alpha(opacity="+(_44.opacity*100)+")";}},_buildLegendItems_Renderer:function(_49,_4a,_4b){var _4c=_4a.parentLayerId;var _4d=esri.geometry.getScale(this.map);var _4e=false;if(!this._respectCurrentMapScale||this._isLayerInScale(_49,_4a,_4d)){var _4f;if(_49.renderer instanceof esri.renderer.UniqueValueRenderer){if(_49.renderer.infos&&_49.renderer.infos.length>0){_4e=true;_4f=_2.create("tbody",{},_2.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},_4b));_2.forEach(_49.renderer.infos,function(_50,_51){var _52=null;if(_49._editable&&_49.types){_52=this._getTemplateFromTypes(_49.types,_50.value);}var _53=_50.label;if(!_53||_53.length===0){_53=_50.value;}this._buildRow_Renderer(_49,_50.symbol,_53,_52,_4f);},this);}}if(_49.renderer instanceof esri.renderer.ClassBreaksRenderer){if(_49.renderer.infos&&_49.renderer.infos.length>0){_4e=true;_4f=_2.create("tbody",{},_2.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},_4b));_2.forEach(_49.renderer.infos,function(_54,_55){var _56=_54.label;if(!_56||_56.length===0){_56=_54.minValue+" - "+_54.maxValue;}this._buildRow_Renderer(_49,_54.symbol,_56,null,_4f);},this);}}if(_49.renderer instanceof esri.renderer.SimpleRenderer){_4e=true;_4f=_2.create("tbody",{},_2.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},_4b));var _57=null;if(_49._editable&&_49.templates&&_49.templates.length>0){_57=_49.templates[0];}this._buildRow_Renderer(_49,_49.renderer.symbol,_49.renderer.label,_57,_4f);}if(!_49._hideDefaultSymbol&&_49.renderer.defaultSymbol){_4e=true;_4f=_2.create("tbody",{},_2.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},_4b));this._buildRow_Renderer(_49,_49.renderer.defaultSymbol,_49.renderer.defaultLabel?_49.renderer.defaultLabel:"others",null,_4f);}}if(_4e){_2.style(_2.byId(this.id+"_"+_49.id+"_"+_4a.id),"display","block");if(_4c>-1){_2.style(_2.byId(this.id+"_"+_49.id+"_"+_4c+"_group"),"display","block");this._findParentGroup(_49.id,_4c);}}return _4e;},_buildRow_Renderer:function(_58,_59,_5a,_5b,_5c){var tr=_2.create("tr",{},_5c);var _5d;var _5e;if(this.alignRight){_5d=_2.create("td",{align:"right"},tr);_5e=_2.create("td",{align:"right",width:35},tr);}else{_5e=_2.create("td",{width:35},tr);_5d=_2.create("td",{},tr);}var _5f=30;if(_59.type=="simplemarkersymbol"){_5f=Math.min(Math.max(_5f,_59.size+12),125);}else{if(_59.type=="picturemarkersymbol"){_5f=Math.min(Math.max(_5f,_59.width),125);}}var div=_2.create("div",{style:"width:"+_5f+"px;height:"+_5f+"px;"},_5e);_2.create("td",{innerHTML:_5a?_5a.replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;").replace(/^#/,""):"",align:(this.alignRight?"right":"")},_2.create("tr",{},_2.create("tbody",{},_2.create("table",{width:"95%"},_5d))));var _60=this._drawSymbol(div,_59,_5f,_5f,_5b,_58.opacity);this._surfaceItems.push(_60);},_drawSymbol:function(_61,sym,_62,_63,_64,_65){var _66=esri.symbol.fromJson(sym.toJson());if(_66.type==="simplelinesymbol"||_66.type==="cartographiclinesymbol"||_66.type==="textsymbol"){if(!_66.color){return;}var _67=_66.color.toRgba();_67[3]=_67[3]*_65;_66.color.setColor(_67);}else{if(_66.type==="simplemarkersymbol"||_66.type==="simplefillsymbol"){if(!_66.color){return;}var _67=_66.color.toRgba();_67[3]=_67[3]*_65;_66.color.setColor(_67);if(_66.outline&&_66.outline.color){_67=_66.outline.color.toRgba();_67[3]=_67[3]*_65;_66.outline.color.setColor(_67);}}else{if(_66.type==="picturemarkersymbol"){_61.style.opacity=_65;_61.style.filter="alpha(opacity=("+_65*100+"))";}}}var _68=_3.gfx.createSurface(_61,_62,_63);if(_2.isIE){var _69=_68.getEventSource();_2.style(_69,"position","relative");_2.style(_69.parentNode,"position","relative");}var _6a=this._getDrawingToolShape(_66,_64)||esri.symbol.getShapeDescriptors(_66);var _6b;try{_6b=_68.createShape(_6a.defaultShape).setFill(_6a.fill).setStroke(_6a.stroke);}catch(e){_68.clear();_68.destroy();return;}var dim=_68.getDimensions();var _6c={dx:dim.width/2,dy:dim.height/2};var _6d=_6b.getBoundingBox(),_6e=_6d.width,_6f=_6d.height;if(_6e>_62||_6f>_63){var _70=_6e>_6f?_6e:_6f;var _71=_62<_63?_62:_63;var _72=(_71-5)/_70;_2.mixin(_6c,{xx:_72,yy:_72});}_6b.applyTransform(_6c);return _68;},_getDrawingToolShape:function(_73,_74){var _75,_76=_74?_74.drawingTool||null:null;switch(_76){case "esriFeatureEditToolArrow":_75={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":_75={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":_75={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":_75={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":_75={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null;}return {defaultShape:_75,fill:_73.getFill(),stroke:_73.getStroke()};},_repaintItems:function(){_2.forEach(this._surfaceItems,function(_77){this._repaint(_77);},this);},_repaint:function(_78){if(!_78){return;}if(_78.getStroke&&_78.setStroke){_78.setStroke(_78.getStroke());}try{if(_78.getFill&&_78.setFill){_78.setFill(_78.getFill());}}catch(e){}if(_78.children&&_2.isArray(_78.children)){_2.forEach(_78.children,this._repaint,this);}},_getTemplateFromTypes:function(_79,_7a){for(var i=0;i<_79.length;i++){if(_79[i].id==_7a&&_79[i].templates&&_79[i].templates.length>0){return _79[i].templates[0];}}return null;},_findParentGroup:function(_7b,_7c,_7d){var _7e=_7c.layerInfos;for(var k=0;k<_7e.length;k++){if(_7d==_7e[k].id){if(_7e[k].parentLayerId>-1){_2.style(_2.byId(this.id+"_"+_7b+"_"+_7e[k].parentLayerId+"_group"),"display","block");this._findParentGroup(_7b,_7c,_7e[k].parentLayerId);}break;}}},_addSubLayersToHide:function(_7f){_2.forEach(_7f.layer._hideLayersInLegend,function(_80){for(var i=0;i<_7f.layer.layerInfos.length;i++){if(_7f.layer.layerInfos[i].id===_80&&_7f.layer.layerInfos[i].subLayerIds){_2.forEach(_7f.layer.layerInfos[i].subLayerIds,function(_81){if(_2.indexOf(_7f.layer._hideLayersInLegend,_81)===-1){_7f.layer._hideLayersInLegend.push(_81);}});}}});},_isLayerInScale:function(_82,_83,_84){var _85=true;if(_82.legendResponse&&_82.legendResponse.layers){for(var i=0;i<_82.legendResponse.layers.length;i++){var _86=_82.legendResponse.layers[i];if(_83.id==_86.layerId){var _87,_88;if((!_82.minScale&&_82.minScale!==0)||(!_82.maxScale&&_82.maxScale!==0)){if(_86.minScale==0&&_82.tileInfo){_87=_82.tileInfo.lods[0].scale;}if(_86.maxScale==0&&_82.tileInfo){_88=_82.tileInfo.lods[_82.tileInfo.lods.length-1].scale;}}else{_87=Math.min(_82.minScale,_86.minScale)||_82.minScale||_86.minScale;_88=Math.max(_82.maxScale,_86.maxScale);}if((_87>0&&_87<_84)||_88>_84){_85=false;}break;}}}else{if(_82.minScale||_82.maxScale){if((_82.minScale&&_82.minScale<_84)||_82.maxScale&&_82.maxScale>_84){_85=false;}}}return _85;},_getServiceTitle:function(_89){var _8a=_89._titleForLegend;if(!_8a){_8a=_89.url;if(!_89.url){_8a="";}else{if(_89.url.indexOf("/MapServer")>-1){_8a=_89.url.substring(0,_89.url.indexOf("/MapServer"));_8a=_8a.substring(_8a.lastIndexOf("/")+1,_8a.length);}else{if(_89.url.indexOf("/ImageServer")>-1){_8a=_89.url.substring(0,_89.url.indexOf("/ImageServer"));_8a=_8a.substring(_8a.lastIndexOf("/")+1,_8a.length);}else{if(_89.url.indexOf("/FeatureServer")>-1){_8a=_89.url.substring(0,_89.url.indexOf("/FeatureServer"));_8a=_8a.substring(_8a.lastIndexOf("/")+1,_8a.length);}}}}if(_89.name){if(_8a.length>0){_8a+=" - "+_89.name;}else{_8a=_89.name;}}}return _3.html.entities.encode(_8a);},_isSupportedLayerType:function(_8b){if(_8b&&(_8b.declaredClass==="esri.layers.ArcGISDynamicMapServiceLayer"||_8b.declaredClass==="esri.layers.ArcGISTiledMapServiceLayer"||_8b.declaredClass==="esri.layers.FeatureLayer"||_8b.declaredClass=="esri.layers.KMLLayer")){return true;}return false;}});_2.mixin(esri.dijit.Legend,{ALIGN_LEFT:0,ALIGN_RIGHT:1});});